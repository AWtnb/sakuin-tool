<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>入力テンプレートの作成</title>
    <base target="_blank">
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../almond.lite.css">
    <link rel="stylesheet" type="text/css" href="../additional.css">
    <style>
        table tr td:nth-child(1) {
            color: #888;
        }

        table tr td:nth-child(2) {
            color: #888;
        }
    </style>
</head>

<body>
    <!-- ============================== -->
    <div class="container">

        <h2>索引拾いのテンプレート生成</h2>


        <div class="ui">
            <textarea class="inputLines" placeholder="paste here!"></textarea>
            <input type="button" value="生成" id="exeButton">
        </div>
        
        <div class="result-markup">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>index</th>
                        <th>ページ</th>
                        <th>項目</th>
                        <th>見よ先</th>
                    </tr>
                </thead>
                <tbody><td></td><td></td><td></td><td></td><td></td></tbody>
            </table>
        </div>
        <input type="button" value="表をコピー" id="copyButton">

        <ul>
            <li>索引拾いのための Excel テンプレートを作成します。</li>
            <li>各ページの項目数を下図のように Excel に整理して下記ボックスに貼り付けてください。</li>
        </ul>
        <img src="./image/img_newtemplate.png">
        <ul>
            <li>下図のように<code>index</code>列に条件付き書式で<code>偶数の場合に背景色変更</code>という設定をするとページの変わり目が見やすくなり便利です。</li>
        </ul>
        <img src="./image/img_generate-index.png">
        <img src="./image/img_generate-index-rule.png">

    </div>

    <script type="module">
        import {Util, setNavi} from "../common.js";
        setNavi();

        function generateTemplare(selector) {
            const lines = Util.getElemValueLines(selector);
            const templateArray = [];
            let idx = 0;
            lines.filter(line => line).forEach(line => {
                const [page, counter, ...rest] = line.split("\t");
                const nItem = Util.toHalfWidth(counter);
                if (Number(nItem) > 0) {
                    idx += 1;
                    for (let i = 0; i < Number(nItem); i++) {
                        templateArray.push({ "Index": idx, "Page": page });
                    }
                }
            });
            return templateArray.map((x, i) => {
                return `<tr><td>${i+1}</td><td>${x.Index}</td><td>${x.Page}</td><td></td><td></td></tr>`;
            });
        }

        document.querySelector("#exeButton").addEventListener("click", () => {
            const outputTable = document.querySelector(".result-markup tbody");
            outputTable.innerHTML = "";
            outputTable.innerHTML = generateTemplare(".ui .inputLines").join("\n")
        });

        document.querySelector("#copyButton").addEventListener("click", () => {
            Util.copyTable(".result-markup tbody");
        });

    </script>
</body>

</html>