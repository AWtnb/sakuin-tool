<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>見よ項目のノンブルをチェック</title>
    <base target="_blank">
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="../style.css">
    <style>
        .result .msg {
            font-weight: bold;
            font-size: .9rem;
        }
        .result .detail {
            padding: 2px 1em;
            max-height: 15em;
            overflow-y: scroll;
            border: 1px solid white;
        }
        .result .detail p {
            font-size: .9rem;
            margin: 0;
        }
    </style>
</head>

<body>
<!-- ============================== -->
<div class="container">
<div class="navi"><a href="/index.html">TOP</a></div>


<h2>見よ項目のノンブルをチェック</h2>

<div class="caption">
    <ul>
        <li>ノンブルを修正したら<a href="../CheckNombre/index.html">ノンブルの並びを再チェック</a>しておくのがオススメです。</li>
    </ul>
</div>

<div class="ui">
    <textarea class="inputLines"placeholder="paste here!" ></textarea>
    <input type="button" value="チェック" onclick="click_check()">

    <div class="result"></div>

    <input type="button" value="チェックリストを印刷" onclick="click_print()">
</div>

</div>
<!-- ============================== -->
<script type="text/javascript" src="../util.js" defer></script>
<script type="text/javascript" src="./src.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/ie-buster@1.1.0/dist/ie-buster.min.js"></script>
<script>

function click_check(){
    const elem = document.querySelector(".ui");
    const output = elem.querySelector(".result");
    output.innerHTML = "";
    const lines = multiline2array(elem.querySelector(".inputLines").value);
    const found = grepNombredReference(lines);
    if (found.length) {
        const markupNombresToRemove = found.map(x => `<p>${x}</p>`);
        const markupItemsToAddNombre = grepItemToAddNombre(lines, found).map(item => {
            return `<p>${item.ReferTo}　←${item.NombreToAdd}</p>`
        });
        output.innerHTML = `<div id="src-nombre-to-remove"><div class="msg">見よ項目にノンブルが残っています：</div><div class="detail">${
            markupNombresToRemove.join("")
        }</div></div>` + `<div id="src-nombre-to-add"><div class="msg">見よ先にノンブルを追加する必要があるかもしれません（追加する必要がないノンブルは<span style="color: #aaa">灰色</span>になります）：</div><div class="detail">${
            markupItemsToAddNombre.join("")
        }</div></div>`;
    }
    else {
        output.innerHTML = "<p>問題ありません！</p>";
    }
}

function click_copy() {
    copyValue(document.querySelector(".ui .result"));
}

function click_print() {
    window.open('./print.html', 'newwindow', 'width=800,height=890');
}


</script>
</body>

</html>
