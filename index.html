<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>sakuin-tool</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="./kuromoji.js"></script>
    <script type="text/javascript" src="./script.js"></script>
    <script src="./ie-buster.js"></script>
</head>

<body>
<div id="container">

<h1>索引作成補助ツール</h1>
<div class="caption">
    <p><b>注：Internet explorer では動作しません！</b></p>
</div>
<div id="navi" class="navigation">
    <ol>
        <li><a href="#index_forCreate">新規作成用ツール</a></li>
            <ol>
                <li><a href="#index_forTemplate">索引拾いのテンプレート生成</a></li>
                <li><a href="#index_forYomi">読みがなの取得</a></li>
                <li><a href="#index_forHairetsu">配列読みに変換</a></li>
                <li><a href="#index_forNayose">名寄せ</a></li>
                <li><a href="#index_forKatahira">カタカナひらがな相互変換</a></li>
            </ol>
        <li><a href="#index_forReuse">旧版再利用ツール</a></li>
            <ol>
                <li><a href="#index_forComplete">子項目の復元</a></li>
                <li><a href="#index_forRelease">名開き</a></li>
            </ol>
    </ol>
</div>
<!-- ======================================================================
新規作成用
====================================================================== -->
<h2 id="index_forCreate">新規作成用ツール</h2>

<!-- ========================================
入力テンプレートの作成
======================================== -->
<h3 id="index_forTemplate">索引拾いのテンプレート生成</h3>

<div class="caption">
    <div class="imagebox">
        <div class="boxtitle">SAMPLE</div>
        <img src="https://i.gyazo.com/4cb522e9dfe14011e64580154cadc6c7.png">
    </div>
    <ul>
        <li>索引拾いのための Excel テンプレートを作成します。</li>
        <li>各ページの項目数を上図のように Excel に整理して下記ボックスに貼り付けてください。</li>
    </ul>
</div>

<div class="inputarea">
    <div class="horizontal">
        <form name="form_toGenerate">
            <textarea name="textarea1" cols="40" rows="10" value="1" placeholder="図のように Excel から貼り付けてください"></textarea>
            <input type="button" value="生成" onclick="clickBtn_generate()" class="button">
            <input type="button" value="表をコピー" onclick="clickBtn_generate_copy()" class="button">
        </form>
    </div>

    <table id="templateTable" border="double">
        <tr>
            <td>ページ</td>
            <td>項目</td>
        </tr>
    </table>
</div>

<script>
    function clickBtn_generate() {
        const linestoGenerate = document.form_toGenerate.textarea1.value;
        const templateArray = generateTemplare(linestoGenerate);

        const resultTable = document.getElementById("templateTable");
        const maxRow = resultTable.rows.length;
        if (maxRow > 1) {
            for (let r = maxRow - 1; r >= 1; r--) {
                resultTable.deleteRow(r);
            }
        }
        templateArray.forEach(line => {
            let row = resultTable.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            cell1.innerHTML = line;
            cell2.innerHTML = "";
        });
    }
    function clickBtn_generate_copy() {
        copyTable("templateTable");
    }
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>
<hr>

<!-- ========================================
読み情報の取得
======================================== -->
<h3 id="index_forYomi">読みがなの取得</h3>

<div class="caption">
    <ul>
        <li>最初の計算時は解析辞書読み込みのために少し時間がかかります。</li>
        <li>正しくよみがなが取得できているか必ず事後確認をしてください。</li>
    </ul>
</div>

<div class="inputarea">
    <div class="horizontal">
        <form name="form_toYomi">
            <textarea name="textarea1" cols="25" rows="20" value="1" placeholder="文字列を貼り付けてください"></textarea>
            <input type="button" value="取得" onclick="clickBtn_yomi()" class="button">
            <textarea name="textarea2" cols="25" rows="20" value="1" placeholder="ここに結果が表示されます" readonly></textarea>
            <input type="button" value="コピー" onclick="clickBtn_yomi_copy()" class="button">
        </form>
    </div>
</div>

<script>
function clickBtn_yomi() {
    const lines = document.form_toYomi.textarea1.value;
    const outputArea = document.form_toYomi.textarea2;
    setYomi(outputArea, lines);
}
function clickBtn_yomi_copy() {
    document.form_toYomi.textarea2.select()
    document.execCommand("Copy");
    alert("コピーしました！");
}
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>
<hr>

<!-- ========================================
配列読みの取得
======================================== -->
<h3 id="index_forHairetsu">配列読みに変換</h3>

<div class="caption">
    <p>テキストボックスに入力された文字列を配列読みに変換します。</p>
</div>

<div class="inputarea">
    <form name="form_removeFlag">
        <input type="checkbox" name="removeFlag" value="remove"> ひらがな・カタカナ・数字以外を削除する
    </form>
    <div class="horizontal">
        <form name="form_toHairetsu">
            <textarea name="textarea1" cols="25" rows="20" value="1" placeholder="文字列を貼り付けてください"></textarea>
            <input type="button" value="変換" onclick="clickBtn_hairetsu()" class="button">
            <textarea name="textarea2" cols="25" rows="20" value="1" readonly placeholder="ここに結果が表示されます"></textarea>
            <input type="button" value="コピー" onclick="clickBtn_hairetsu_copy()" class="button">
        </form>
    </div>
</div>

<script>
    function clickBtn_hairetsu() {
        const lines_toHairetsu = document.form_toHairetsu.textarea1.value;
        const removeFlag = document.form_removeFlag.removeFlag;
        let converted = [];
        if (removeFlag.checked) {
            converted = toHairetsu(lines_toHairetsu, true);
        }
        else {
            converted = toHairetsu(lines_toHairetsu, false);
        }
        const msg = converted.join("\n");
        document.form_toHairetsu.textarea2.value = msg;
    }
    function clickBtn_hairetsu_copy() {
        document.form_toHairetsu.textarea2.select();
        document.execCommand("Copy");
        alert("コピーしました！");
    }
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>
<hr>

<!-- ========================================
名寄せ
======================================== -->
<h3 id="index_forNayose">名寄せ</h3>
<div class="caption">
    <ul>
        <li>ソート機能はありません。上から表示されている順番通りに名寄せします。</li>
        <li>見よ項目など、ノンブルが記入されていない場合はそのまま表示します。</li>
        <li>子項目は手動で作成してください。</li>
    </ul>
    <div class="imagebox">
        <div class="boxtitle">SAMPLE</div>
        <img src = "https://i.gyazo.com/3ab3b7d640fa94adb97b06fc96658789.png">
    </div>
</div>

<div class="inputarea">
    <div class="horizontal">
        <form name="form_toNayose">
            <textarea name="textarea1" cols="25" rows="20" value="1" placeholder="上図のように Excel からコピー＆ペーストしてください"></textarea>
            <input type="button" value="名寄せ" onclick="clickBtn_nayose()" class="button">
            <textarea name="textarea2" cols="25" rows="20" value="1" placeholder="結果が表示されます" readonly></textarea>
            <input type="button" value="コピー" onclick="clickBtn_nayose_copy()" class="button">
        </form>
    </div>
</div>

<script>
function clickBtn_nayose() {
    const lines_toNayose = document.form_toNayose.textarea1.value;
    const nys = nayose(lines_toNayose);
    const msg = nys.join("\n");
    document.form_toNayose.textarea2.value = msg;
}
function clickBtn_nayose_copy() {
    document.form_toNayose.textarea2.select();
    document.execCommand("Copy");
    alert("コピーしました！");
}
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>
<hr>

<!-- ========================================
カタカナひらがな相互変換
======================================== -->
<h3 id="index_forKatahira">カタカナひらがな相互変換</h3>
<div class="caption">
    <p>テキストボックスに入力された文字列をカタカナ／ひらがなに変換します。</p>
</div>

<div class="inputarea">
    <form id="form_katahiraFlag">
        <label><input type="radio" name="radio1" value="toKata" checked>ひらがな→カタカナ</label>
        <label><input type="radio" name="radio1" value="toHira"        >カタカナ→ひらがな</label>
    </form>
    <div class="horizontal">
        <form name="form_toConvert">
            <textarea name="textarea1" cols="25" rows="20" value="1" placeholder="文字列を貼り付けてください"></textarea>
            <input type="button" value="変換" onclick="clickBtn_katahira()" class="button">
            <textarea name="textarea2" cols="25" rows="20" value="1" placeholder="結果が表示されます" readonly></textarea>
            <input type="button" value="コピー" onclick="clickBtn_katahira_copy()" class="button">
        </form>
    </div>
</div>

<script>
function clickBtn_katahira() {
    const lines_toConvert = document.form_toConvert.textarea1.value;
    let element = document.getElementById("form_katahiraFlag");
    let radioList = element.radio1;
    let mode = radioList.value;
    if (mode == "toKata") {
        msg = hira2kata(lines_toConvert);
    }
    else {
        msg = kata2hira(lines_toConvert);
    }
    document.form_toConvert.textarea2.value = msg;
}
function clickBtn_katahira_copy() {
    document.form_toConvert.textarea2.select();
    document.execCommand("Copy");
    alert("コピーしました！");
}
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>

<!-- ======================================================================
旧版の活用
====================================================================== -->
<h2 id="index_forReuse">旧版再利用ツール</h2>

<!-- ========================================
子項目の復元
======================================== -->
<h3 id="index_forComplete">子項目の復元</h3>

<div class="caption">
    <div class="imagebox">
        <div class="boxtitle">SAMPLE</div>
        <img src="https://i.gyazo.com/2bbc343e73bcd735473dd7082abbba43.png" height="200">
    </div>
    <ul>
        <li>索引項目中の子項目を復元します（上図）。</li>
        <li>ノンブルが入っていても動作します。</li>
        <li>改訂時に旧版の索引を再利用する際などにご利用ください。</li>
    </ul>
</div>

<div class="inputarea">
    項目とノンブルの間の文字（ノンブルが入っていない場合はどちらを選択しても同じ結果になります）：
    <form name="form_delim">
        <input type="radio" name="delim1" value="　　" checked> 二倍アキ
        <input type="radio" name="delim1" value="\t" > タブ文字（Excel）
    </form>
    <div class="horizontal">
        <form name="form_toComplete">
            <textarea name="textarea1" cols="25" rows="20" value="1" placeholder="索引を貼り付けてください"></textarea>
            <input type="button" value="復元" onclick="clickBtn_complete()" class="button">
            <textarea name="textarea2" cols="25" rows="20" value="1" placeholder="結果が表示されます" readonly></textarea>
            <input type="button" value="コピー" onclick="clickBtn_complete_copy()" class="button">
        </form>
    </div>
</div>

<script>
    function clickBtn_complete() {
        let delimiter = "　　"
        const delimRadioBtn = document.form_delim.delim1;
        for (let i = 0; i < delimRadioBtn.length; i++){
            if(delimRadioBtn[i].checked){
                delimiter = delimRadioBtn[i].value;
                break;
            }
        }
        const lines_toComplete = document.form_toComplete.textarea1.value;
        const completedArray = completeChildItem(lines_toComplete, delimiter);
        document.form_toComplete.textarea2.value = completedArray.join("\n");
    }
    function clickBtn_complete_copy() {
        document.form_toComplete.textarea2.select();
        document.execCommand("Copy");
        alert("コピーしました！");
    }
</script>

<div class="back2top"><a href="#navi">目次に戻る</a></div>
<hr>

<!-- ========================================
名開き
======================================== -->
<h3 id="index_forRelease">名開き</h3>

<div class="caption"><div class="imagebox">
    <div class="boxtitle">SAMPLE</div>
        <img src="https://i.gyazo.com/1cf1286b016173909636921bdf18d68e.png" height="300">
    </div>
    <ul>
        <li>名寄せされた状態の索引を「項目－ノンブル」の1対1対応に戻します（上図）。</li>
        <li>子項目や見よ項目はそのまま残ります。</li>
        <li>改訂時に旧版の索引を再利用する際などにご利用ください。</li>
    </ul>
</div>

<div class="inputarea">
    「項目」と「ノンブル」の間の文字：
    <form name="form_delimiter">
        <input type="radio" name="delim1" value="　　" checked> 2倍アキ
        <input type="radio" name="delim1" value="\t" > タブ文字（Excel）
    </form>
    「ノンブル」列のカンマの種類：
    <form name="form_nombreConnector">
        <input type="radio" name="connect1" value="，" checked> 全角モノ
        <input type="radio" name="connect1" value="," > 半角モノ
    </form>

    <div class="horizontal">
        <form name="form_toRelease">
            <textarea name="textarea1" cols="40" rows="10" value="1" placeholder="名寄せ済みの文字列を貼り付けてください"></textarea>
            <input type="button" value="名開き" onclick="clickBtn_release()" class="button">
            <input type="button" value="表をコピー" onclick="clickBtn_release_copy()" class="button">
        </form>
    </div>

    <table id="releaseTable" border="double">
        <tr>
            <td>項目</td>
            <td>ノンブル</td>
        </tr>
    </table>
</div>

<div class="back2top"><a href="#navi">目次に戻る</a></div>

<script>
    function clickBtn_release() {
        let delimiter = "\t"
        const delimRadioBtn = document.form_delimiter.delim1;
        for (let i = 0; i < delimRadioBtn.length; i++){
            if(delimRadioBtn[i].checked){
                delimiter = delimRadioBtn[i].value;
                break;
            }
        }

        let nombreConnector = "，"
        const commaRadioBtn = document.form_nombreConnector.connect1;
        for (let j = 0; j < commaRadioBtn.length; j++){
            if(commaRadioBtn[j].checked){
                nombreConnector = commaRadioBtn[j].value;
                break;
            }
        }
        const linesToRelease = document.form_toRelease.textarea1.value;
        const releasedObj = releaseNayoseLines(linesToRelease, nombreConnector, delimiter);

        const resultTable = document.getElementById("releaseTable");
        const maxRow = resultTable.rows.length;
        if (maxRow > 1) {
            for (let r = maxRow - 1; r >= 1; r--) {
                resultTable.deleteRow(r);
            }
        }
        for (let item in releasedObj) {
            let row = resultTable.insertRow(-1);
            let cell1 = row.insertCell(0);
            let cell2 = row.insertCell(1);
            cell1.innerHTML = releasedObj[item].name;
            cell2.innerHTML = releasedObj[item].nombre;
        }
    }

    function clickBtn_release_copy() {
        copyTable("releaseTable");
    }
</script>

</div>
</body>
<!-- ========================================
footer
======================================== -->
<footer>
<p><img src="https://img.icons8.com/small/16/000000/github.png"> <a href="https://github.com/AWtnb/sakuin-tool" target="_blank">Github repository</a></p>
</footer>
</html>
