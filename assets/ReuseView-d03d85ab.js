import{S as A}from"./SectionEnd-37178fba.js";import{P as $}from"./PasteBox-7e4fa53b.js";import{R as B}from"./ResultBox-285f32dc.js";import{_ as g,r as d,o as p,a as m,e as s,w as v,v as b,f as h,b as a,t as f,F as _,g as C,h as y,p as F,d as H}from"./index-42f53b86.js";import{E as k,A as R}from"./entryHandler-ea7f15d2.js";import{C as L}from"./CopyButton-d9fc40d0.js";const U=e=>{const t=String(e).match(/\d[\d,\u2013]*$/);return t?t[0]:""},w=["‐","‑","‒","–","—","―","－","─","-"],V=e=>{let t=e.split(",")[0];return t=t.replace(/\d+$/,""),w.includes(t.at(-1))&&t.at(-2).match(/\d/)&&(t=t.replace(/.$/,""),t=t.replace(/\d+$/,"")),t};class x{constructor(t){this.valiation=w,this.rawStr=t}format(t="–"){let n=this.rawStr;return this.valiation.forEach(r=>{n=n.replaceAll(r,"-")}),n.replace(/\u002d+/g,t)}getHeaderLen(){let t=0;for(let n=0;n<this.rawStr.length&&this.valiation.includes(this.rawStr[n]);n++)t+=1;return t}getTrailerLen(){let t=0;for(let n=this.rawStr.length-1;0<=n&&this.valiation.includes(this.rawStr[n]);n--)t+=1;return t}formatChildEntry(){const t=this.getHeaderLen(),n=t>0?"――":"",r=this.getTrailerLen(),l=r>0?"――":"";return n+this.rawStr.slice(t,this.rawStr.length-r)+l}}class O{constructor(t){this.prefix=t.startsWith(" ")||t.startsWith("　")?"　":"";const n=String(t).replace(/\uff0c/g,",").replace(/\s+/g,""),r=U(new x(n).format());if(r.length>0){this.address=r.replaceAll(",",", "),this.name=V(n);return}if(this.address="",n.indexOf("→")!=-1){this.name=n.replace(/→/,"　→");return}this.name=n}getFormattedLine(){const t=this.prefix+new x(this.name).formatChildEntry();return this.address.length>0?t+"　　"+this.address:t}}const P=e=>e.map(t=>String(t).trimEnd().replace(/\t/,"　　")).map(t=>({formatted:new O(t).getFormattedLine(),original:t})),T={name:"FormatOld",data:function(){return{content:"",fmtArr:[],message:"",skipHeader:!0}},components:{PasteBox:$,ResultBox:B},computed:{contentLines:function(){const e=this.content.split(/\n/).map(t=>String(t));return this.skipHeader?e.slice(1):e},resultStr:function(){return this.fmtArr.map(e=>e.formatted).join(`
`)},modified:function(){return this.fmtArr.filter(e=>e.formatted!=e.original)}},methods:{reset:function(){this.fmtArr=[]},executeFormat:function(){this.reset(),P(this.contentLines).forEach(e=>{this.fmtArr.push(e)}),this.modified.length>0?this.message=this.modified.length+"箇所を修正しました！":this.message="問題のある箇所は見当たりませんでした！"}}},E=e=>(F("data-v-dd6374d3"),e=e(),H(),e),I=E(()=>s("h2",null,"ゲラから抽出した索引データの整形",-1)),N=E(()=>s("ul",null,[s("li",null,[s("strong",null,"ゲラからテキストを抽出すると長い行が折り返されて改行になっていることがあります。"),s("ul",null,[s("li",null,"そうした箇所は先に手動で整形してください。")])]),s("li",null,"見よ項目の矢印の前のアキを1倍モノに統一します。"),s("li",null,[h("連続するノンブルを示すダーシの種類を"),s("code",null,"–"),h("（enダーシ）に統一します。")]),s("li",null,[h("子項目のダーシの種類を"),s("code",null,"――"),h("（2倍ダーシ）に統一します。")])],-1)),W={key:0},j={class:"original"},D={class:"formatted"};function M(e,t,n,r,l,o){const u=d("PasteBox"),c=d("ResultBox");return p(),m(_,null,[I,s("label",null,[v(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.skipHeader=i)},null,512),[[b,e.skipHeader]]),h("先頭行をスキップする")]),a(u,{onUpdateContent:t[1]||(t[1]=i=>e.content=i.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),N,a(c,{result:o.resultStr},null,8,["result"]),s("div",null,[s("h4",null,f(e.message),1),o.modified.length?(p(),m("ol",W,[(p(!0),m(_,null,C(o.modified,(i,S)=>(p(),m("li",{key:S},[s("ul",null,[s("li",j,f(i.original),1),s("li",D,f(i.formatted),1)])]))),128))])):y("",!0)])],64)}const q=g(T,[["render",M],["__scopeId","data-v-dd6374d3"]]),z="/sakuin-tool/assets/resolveChild-958e8e93.png",G=e=>{const t=[],n=[];t.push(e[0]),n.push(new k(e[0]).basename);for(let r=1;r<e.length;r++){const l=new k(e[r]),o=l.basename;if(o.startsWith("――")){const u=n.at(-1)+o.substring(2);t.push(u+"　　"+l.address)}else if(o.endsWith("――")){const u=o.substring(0,o.length-2)+n.at(-1);t.push(u+"　　"+l.address)}else t.push(l.rawStr),n.push(o)}return t},J={name:"ResolveChild",data:function(){return{content:"",fmtArr:[],skipHeader:!0}},components:{PasteBox:$,ResultBox:B},computed:{contentLines:function(){const e=this.content.split(/\n/).map(t=>String(t));return this.skipHeader?e.slice(1):e},pureLines:function(){return this.contentLines.filter(e=>e.trim()).map(e=>e.trim())},resultStr:function(){return this.fmtArr.join(`
`)}},methods:{reset:function(){this.fmtArr=[]},executeFormat:function(){this.reset(),G(this.pureLines).forEach(e=>{this.fmtArr.push(e)})}}},K=s("h2",null,"子項目の復元",-1),Q=s("div",null,[s("img",{src:z,alt:""})],-1);function X(e,t,n,r,l,o){const u=d("PasteBox"),c=d("ResultBox");return p(),m(_,null,[K,s("label",null,[v(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.skipHeader=i)},null,512),[[b,e.skipHeader]]),h("先頭行をスキップする")]),a(u,{onUpdateContent:t[1]||(t[1]=i=>e.content=i.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),a(c,{result:o.resultStr},null,8,["result"]),Q],64)}const Y=g(J,[["render",X]]),Z={name:"UngroupedTable",props:{lines:Array,resultStr:String},components:{CopyButton:L}},tt={key:0},et={class:"limit-height"},nt=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ノンブル")])],-1);function st(e,t,n,r,l,o){const u=d("CopyButton");return n.lines.length?(p(),m("div",tt,[s("div",et,[s("table",null,[nt,s("tbody",null,[(p(!0),m(_,null,C(n.lines,(c,i)=>(p(),m("tr",{key:i},[s("td",null,f(c.name),1),s("td",null,f(c.nombre),1)]))),128))])])]),a(u,{copyStr:n.resultStr},null,8,["copyStr"])])):y("",!0)}const rt=g(Z,[["render",st]]),ot="/sakuin-tool/assets/ungroup-57a732db.png",it=e=>{const t=[];return e.filter(n=>n.trim()).map(n=>n.replace("	","　　")).forEach(n=>{const r=new k(n);r.isReference?t.push({name:r.name,nombre:""}):new R(r.address).nombres.forEach(l=>{t.push({name:r.name,nombre:l.display.text})})}),t},lt={name:"Ungroup",data:function(){return{content:"",ungroupedLines:[],skipHeader:!0}},components:{CopyButton:L,PasteBox:$,UngroupedTable:rt},computed:{contentLines:function(){const e=this.content.split(/\n/).map(t=>String(t));return this.skipHeader?e.slice(1):e},resultStr:function(){return this.ungroupedLines.map(e=>`${e.name}	${e.nombre}`.trimEnd()).join(`
`)}},methods:{reset:function(){this.ungroupedLines=[]},executeFormat:function(){this.reset(),it(this.contentLines).forEach((e,t)=>{this.ungroupedLines.push(e)})}}},ut=s("h2",null,"名開き",-1),at=s("div",null,[s("img",{src:ot,alt:""})],-1);function ct(e,t,n,r,l,o){const u=d("PasteBox"),c=d("UngroupedTable");return p(),m(_,null,[ut,s("label",null,[v(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.skipHeader=i)},null,512),[[b,e.skipHeader]]),h("先頭行をスキップする")]),a(u,{onUpdateContent:t[1]||(t[1]=i=>e.content=i.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),a(c,{lines:e.ungroupedLines,resultStr:o.resultStr},null,8,["lines","resultStr"]),at],64)}const dt=g(lt,[["render",ct]]),pt={name:"ReuseView",components:{SectionEnd:A,FormatOld:q,ResolveChild:Y,Ungroup:dt}},mt={class:"reuse"},ht=s("h1",null,"旧版索引の再利用",-1);function ft(e,t,n,r,l,o){const u=d("FormatOld"),c=d("SectionEnd"),i=d("ResolveChild"),S=d("Ungroup");return p(),m("div",mt,[ht,a(u),a(c),a(i),a(c),a(S),a(c)])}const bt=g(pt,[["render",ft]]);export{bt as default};
