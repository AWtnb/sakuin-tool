import{S as B}from"./SectionEnd-07fd441b.js";import{P as S,a as T}from"./PasteBox-39580ba4.js";import{E as L,A as j}from"./entryHandler-ea7f15d2.js";import{_ as g,o,a as i,e as s,F as v,g as k,t as p,h as b,r as $,b as m,i as f,j as x,u as N,f as C,w as A,l as w,n as P,p as U,d as I}from"./index-294494d2.js";class H{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new L(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.referred=this.entries.filter(e=>e.referredFrom.length>0)}goalLostReference(){return this.refs.map(t=>this.nonRefs.filter(n=>n.basename==t.referTo&&n.referredFrom.includes(t.basename)).length>0?null:{problem:t.name,require:`${t.referTo}（${t.basename}）`}).filter(Boolean)}requiredFromReference(){return this.referred.map(t=>{const e=t.referredFrom.filter(n=>this.refs.filter(l=>l.basename==n&&l.referTo==t.basename).length<1);return e.length<1?null:{problem:t.name,require:e.map(n=>`${n}　→${t.basename}`)}}).filter(Boolean)}findAdjacent(){const t=[];return this.entries.forEach((e,n)=>{if(e.isReference){const r=this.entries[n-1];r&&!r.isReference&&r.referredFrom.includes(e.basename)&&t.push(e);const l=this.entries[n+1];l&&!l.isReference&&l.referredFrom.includes(e.basename)&&t.push(e)}}),t.map(e=>e.name)}}class W{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new L(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.mainEntries=this.nonRefs.filter(e=>!e.isChild),this.referred=this.entries.filter(e=>e.referredFrom.length>0),this.nonReferred=this.entries.filter(e=>e.referredFrom.length<1)}getUngrouped(){const t=[];return this.mainEntries.forEach(e=>{const n=e.basename,r=this.mainEntries.filter(l=>l.basename==n);r.length!=1&&(t.map(l=>l.id).includes(n)||t.push({id:n,detail:r.map(l=>l.rawStr)}))}),t.map(e=>e.detail)}getConflicting(){return this.refs.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename==e);return n.length<1?null:[t.name].concat(n.map(r=>r.rawStr))}).filter(Boolean)}}const z={name:"RefLostTo",props:{lostTo:{type:Array,require:!0}}},G={key:0},M=s("h3",null,"見よ項目があるのに参照先に括弧で付記されていないものがあります！",-1),O=s("thead",null,[s("tr",null,[s("th",null,"見よ項目"),s("th",null,"ヌケ")])],-1);function J(d,t,e,n,r,l){return e.lostTo.length?(o(),i("div",G,[M,s("table",null,[O,s("tbody",null,[(o(!0),i(v,null,k(e.lostTo,(a,u)=>(o(),i("tr",{key:u},[s("td",null,p(a.problem),1),s("td",null,p(a.require),1)]))),128))])])])):b("",!0)}const K=g(z,[["render",J]]),Q={name:"DetailList",props:{details:{type:Array,require:!0}}};function X(d,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,k(e.details,(a,u)=>(o(),i("li",{key:u},p(a),1))),128))])}const E=g(Q,[["render",X]]),Y={name:"RefLostFrom",props:{lostFrom:{type:Array,require:!0}},components:{DetailList:E}},Z={key:0},ee=s("h3",null,"参照元として括弧書きされているのに見よ項目がないものがあります！",-1),te=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ヌケ")])],-1);function ne(d,t,e,n,r,l){const a=$("DetailList");return e.lostFrom.length?(o(),i("div",Z,[ee,s("table",null,[te,s("tbody",null,[(o(!0),i(v,null,k(e.lostFrom,(u,c)=>(o(),i("tr",{key:c},[s("td",null,p(u.problem),1),s("td",null,[m(a,{details:u.require},null,8,["details"])])]))),128))])])])):b("",!0)}const se=g(Y,[["render",ne]]),re={name:"DuplicateTable",props:{detailsArr:{type:Array,require:!0}},components:{DetailList:E}},le=s("thead",null,[s("tr",null,[s("th",null,"重複項目")])],-1);function oe(d,t,e,n,r,l){const a=$("detail-list");return o(),i("table",null,[le,s("tbody",null,[(o(!0),i(v,null,k(e.detailsArr,(u,c)=>(o(),i("tr",{key:c},[s("td",null,[m(a,{details:u},null,8,["details"])])]))),128))])])}const ie=g(re,[["render",oe]]),ae={name:"RefDuplicate",props:{msg:{type:String,require:!0},duplicateRefs:{type:Array,require:!0}},components:{DuplicateTable:ie}},ue={key:0};function ce(d,t,e,n,r,l){const a=$("DuplicateTable");return e.duplicateRefs.length?(o(),i("div",ue,[s("h3",null,p(e.msg),1),m(a,{detailsArr:e.duplicateRefs},null,8,["detailsArr"])])):b("",!0)}const V=g(ae,[["render",ce]]),de={name:"RefAdjacent",props:{adjacentRefs:{type:Array,require:!0}},components:{DetailList:E}},he={key:0},me=s("h3",null,"見よ項目と見よ先項目が隣接しているものがあります！",-1);function fe(d,t,e,n,r,l){const a=$("DetailList");return e.adjacentRefs.length?(o(),i("div",he,[me,m(a,{details:e.adjacentRefs},null,8,["details"])])):b("",!0)}const pe=g(de,[["render",fe]]),_e=s("h2",null,"見よ項目の対応チェック",-1),ve={key:0},be={__name:"CheckRefs",setup(d){const t=f(""),e=f([]),n=f([]),r=f([]),l=f([]),a=f([]),u=f(""),c=x(()=>T(t.value)),h=x(()=>e.value.length+n.value.length+r.value.length+l.value.length+a.value.length==0),_=()=>{e.value=[],n.value=[],r.value=[],l.value=[],a.value=[],u.value=""},F=()=>{_();const R=new H(c.value);e.value=R.goalLostReference(),n.value=R.requiredFromReference(),r.value=R.findAdjacent();const y=new W(c.value);l.value=y.getUngrouped(),a.value=y.getConflicting(),h.value&&(u.value="問題は見当たりません！ 完璧かもしれません！")};return(R,y)=>(o(),i(v,null,[_e,m(S,{onUpdateContent:y[0]||(y[0]=D=>t.value=D.target.value),onButtonClicked:F}),s("div",null,[m(K,{lostTo:e.value},null,8,["lostTo"]),m(se,{lostFrom:n.value},null,8,["lostFrom"]),m(V,{duplicateRefs:l.value,msg:"見よ項目から参照されている項目の名寄せが不十分です！"},null,8,["duplicateRefs"]),m(V,{duplicateRefs:a.value,msg:"見よ項目が本項目として残っています！"},null,8,["duplicateRefs"]),m(pe,{adjacentRefs:r.value},null,8,["adjacentRefs"]),N(h)?(o(),i("div",ve,p(u.value),1)):b("",!0)])],64))}},ge={name:"PossibleList",props:{children:Array}},$e={key:0},ke={key:1};function Re(d,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,k(e.children,(a,u)=>(o(),i("li",{key:u},[s("span",null,[a.pre.length?(o(),i("mark",$e,p(a.pre),1)):b("",!0),C(p(a.rest),1),a.post.length?(o(),i("mark",ke,p(a.post),1)):b("",!0)])]))),128))])}const ye=g(ge,[["render",Re]]),Ce={name:"FoundTable",components:{PossibleList:ye},props:{found:Array}},xe={key:0},Le={class:"limit-height"},Fe=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"子項目候補")])],-1);function Ae(d,t,e,n,r,l){const a=$("PossibleList");return e.found.length?(o(),i("div",xe,[s("div",Le,[s("table",null,[Fe,s("tbody",null,[(o(!0),i(v,null,k(e.found,(u,c)=>(o(),i("tr",{key:c},[s("td",null,p(u.parent),1),s("td",null,[m(a,{children:u.children},null,8,["children"])])]))),128))])])])])):b("",!0)}const we=g(Ce,[["render",Ae]]);class Se{constructor(t,e){this.name=t,this.mode=e,this.modified=!1,this.pre="",this.post="",this.rest=""}search(t){(this.mode=="all"||this.mode=="head")&&this.name.startsWith(t)&&(this.pre=t,this.modified=!0),this.rest=this.name.substring(this.pre.length),(this.mode=="all"||this.mode=="tail")&&this.name.endsWith(t)&&(this.post=t,this.modified=!0),this.rest=this.rest.substring(0,this.rest.length-this.post.length)}}class Te{constructor(t,e="tail"){this.mode=e,this.mainEntries=t.filter(n=>String(n).trim()).map(n=>new L(n)).filter(n=>!n.isReference&&!n.isChild).map(n=>({name:n.name,basename:n.basename}))}findPossibles(){return this.mainEntries.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename!=e).map(r=>{const l=new Se(r.basename,this.mode);return l.search(e),l.modified?l:null}).filter(Boolean);return{parent:t.name,children:n}}).filter(t=>t.children.length>0).sort((t,e)=>e.parent.length-t.parent.length)}}const Ee=s("h2",null,"子項目候補をチェックする",-1),Ve={__name:"CheckChild",setup(d){const t=f(""),e=f("all"),n=f([]),r=x(()=>T(t.value)),l=()=>{n.value=[]},a=()=>{l();const u=new Te(r.value,e.value);n.value=u.findPossibles()};return(u,c)=>(o(),i(v,null,[Ee,m(S,{onUpdateContent:c[0]||(c[0]=h=>t.value=h.target.value),onButtonClicked:a}),s("div",null,[s("label",null,[A(s("input",{type:"radio",value:"tail","onUpdate:modelValue":c[1]||(c[1]=h=>e.value=h)},null,512),[[w,e.value]]),C("末尾一致")]),s("label",null,[A(s("input",{type:"radio",value:"head","onUpdate:modelValue":c[2]||(c[2]=h=>e.value=h)},null,512),[[w,e.value]]),C("先頭一致")]),s("label",null,[A(s("input",{type:"radio",value:"all","onUpdate:modelValue":c[3]||(c[3]=h=>e.value=h)},null,512),[[w,e.value]]),C("両方")])]),m(we,{found:n.value},null,8,["found"])],64))}};class qe{constructor(t){const e=new L(t);this.nombres=new j(e.address).nombres,this.problems=[]}checkSort(){if(!(this.nombres.length<2)){for(let t=0;t<this.nombres.length-1;t++)if(this.nombres[t].intValue>=this.nombres[t+1].intValue){this.problems.push({color:"red",text:"順番！"});break}}}checkHyphen(){if(!(this.nombres.length<3))for(let t=0;t<this.nombres.length-2;t++){const e=this.nombres[t],n=this.nombres[t+1],r=this.nombres[t+2];if(e.intValue+1==n.intValue&&e.intValue+2==r.intValue&&!n.hyphenated){this.problems.push({color:"blue",text:"連続！"});break}}}}const q=d=>(U("data-v-d03659ec"),d=d(),I(),d),De=q(()=>s("h2",null,"ノンブルの並びをチェックする",-1)),Be=q(()=>s("p",null,"※ノンブルに半角数字以外が含まれている場合は正しく判定できません。",-1)),je={key:0,class:"warning"},Ne={key:1},Pe={__name:"CheckNombre",setup(d){const t=c=>c.filter(h=>String(h).trim()).map(h=>{const _=new qe(h);return _.checkSort(),_.checkHyphen(),_.problems.length>0?{line:h,detail:_.problems}:null}).filter(Boolean),e=f(""),n=f(""),r=f([]),l=x(()=>T(e.value)),a=()=>{n.value="",r.value=[]},u=()=>{a(),r.value=t(l.value),r.value.length?n.value="修正の必要があります！":n.value="問題は見当たりません！"};return(c,h)=>(o(),i(v,null,[De,m(S,{onUpdateContent:h[0]||(h[0]=_=>e.value=_.target.value),onButtonClicked:u}),Be,n.value?(o(),i("strong",je,p(n.value),1)):b("",!0),r.value.length?(o(),i("ul",Ne,[(o(!0),i(v,null,k(r.value,(_,F)=>(o(),i("li",{key:F},[s("span",null,p(_.line),1),(o(!0),i(v,null,k(_.detail,(R,y)=>(o(),i("span",{key:y},[s("span",{style:P({color:R.color})},"←"+p(R.text),5)]))),128))]))),128))])):b("",!0)],64))}},Ue=g(Pe,[["__scopeId","data-v-d03659ec"]]),Ie={name:"CheckView",components:{SectionEnd:B,CheckRefs:be,CheckChild:Ve,CheckNombre:Ue}},He={class:"check"},We=s("h1",null,"索引のチェック",-1);function ze(d,t,e,n,r,l){const a=$("CheckRefs"),u=$("SectionEnd"),c=$("CheckChild"),h=$("CheckNombre");return o(),i("div",He,[We,m(a),m(u),m(c),m(u),m(h),m(u)])}const Ke=g(Ie,[["render",ze]]);export{Ke as default};
