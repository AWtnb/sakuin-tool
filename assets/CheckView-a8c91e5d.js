import{S as A}from"./SectionEnd-c9716df7.js";import{P as S,a as q}from"./PasteBox-23b110c5.js";import{E as L,A as j}from"./entryHandler-ea7f15d2.js";import{_ as b,o,a as i,e as s,F as v,g as $,t as p,h as g,b as h,r as R,i as f,j as x,u as P,f as C,w as T,l as w,n as N,p as U,d as I}from"./index-71ca2f42.js";class H{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new L(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.referred=this.entries.filter(e=>e.referredFrom.length>0)}goalLostReference(){return this.refs.map(t=>this.nonRefs.filter(n=>n.basename==t.referTo&&n.referredFrom.includes(t.basename)).length>0?null:{problem:t.name,require:`${t.referTo}（${t.basename}）`}).filter(Boolean)}requiredFromReference(){return this.referred.map(t=>{const e=t.referredFrom.filter(n=>this.refs.filter(l=>l.basename==n&&l.referTo==t.basename).length<1);return e.length<1?null:{problem:t.name,require:e.map(n=>`${n}　→${t.basename}`)}}).filter(Boolean)}findAdjacent(){const t=[];return this.entries.forEach((e,n)=>{if(e.isReference){const r=this.entries[n-1];r&&!r.isReference&&r.referredFrom.includes(e.basename)&&t.push(e);const l=this.entries[n+1];l&&!l.isReference&&l.referredFrom.includes(e.basename)&&t.push(e)}}),t.map(e=>e.name)}}class W{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new L(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.mainEntries=this.nonRefs.filter(e=>!e.isChild),this.referred=this.entries.filter(e=>e.referredFrom.length>0),this.nonReferred=this.entries.filter(e=>e.referredFrom.length<1)}getUngrouped(){const t=[];return this.mainEntries.forEach(e=>{const n=e.basename,r=this.mainEntries.filter(l=>l.basename==n);r.length!=1&&(t.map(l=>l.id).includes(n)||t.push({id:n,detail:r.map(l=>l.rawStr)}))}),t.map(e=>e.detail)}getConflicting(){return this.refs.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename==e);return n.length<1?null:[t.name].concat(n.map(r=>r.rawStr))}).filter(Boolean)}}const z={name:"RefLostTo",props:{lostTo:{type:Array,require:!0}}},G={key:0},M=s("h3",null,"見よ項目があるのに参照先に括弧で付記されていないものがあります！",-1),O=s("thead",null,[s("tr",null,[s("th",null,"見よ項目"),s("th",null,"ヌケ")])],-1);function J(c,t,e,n,r,l){return e.lostTo.length?(o(),i("div",G,[M,s("table",null,[O,s("tbody",null,[(o(!0),i(v,null,$(e.lostTo,(a,u)=>(o(),i("tr",{key:u},[s("td",null,p(a.problem),1),s("td",null,p(a.require),1)]))),128))])])])):g("",!0)}const K=b(z,[["render",J]]),Q={name:"DetailList",props:{details:{type:Array,require:!0}}};function X(c,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,$(e.details,(a,u)=>(o(),i("li",{key:u},p(a),1))),128))])}const D=b(Q,[["render",X]]),Y={name:"RefLostFrom",props:{lostFrom:{type:Array,require:!0}},components:{DetailList:D}},Z={key:0},ee=s("h3",null,"参照元として括弧書きされているのに見よ項目がないものがあります！",-1),te=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ヌケ")])],-1);function ne(c,t,e,n,r,l){const a=R("DetailList");return e.lostFrom.length?(o(),i("div",Z,[ee,s("table",null,[te,s("tbody",null,[(o(!0),i(v,null,$(e.lostFrom,(u,d)=>(o(),i("tr",{key:d},[s("td",null,p(u.problem),1),s("td",null,[h(a,{details:u.require},null,8,["details"])])]))),128))])])])):g("",!0)}const se=b(Y,[["render",ne]]),re={name:"DuplicateTable",props:{detailsArr:{type:Array,require:!0}},components:{DetailList:D}},le=s("thead",null,[s("tr",null,[s("th",null,"重複項目")])],-1);function oe(c,t,e,n,r,l){const a=R("detail-list");return o(),i("table",null,[le,s("tbody",null,[(o(!0),i(v,null,$(e.detailsArr,(u,d)=>(o(),i("tr",{key:d},[s("td",null,[h(a,{details:u},null,8,["details"])])]))),128))])])}const ie=b(re,[["render",oe]]),ae={name:"RefDuplicate",props:{msg:{type:String,require:!0},duplicateRefs:{type:Array,require:!0}},components:{DuplicateTable:ie}},ue={key:0};function ce(c,t,e,n,r,l){const a=R("DuplicateTable");return e.duplicateRefs.length?(o(),i("div",ue,[s("h3",null,p(e.msg),1),h(a,{detailsArr:e.duplicateRefs},null,8,["detailsArr"])])):g("",!0)}const E=b(ae,[["render",ce]]),de={name:"RefAdjacent",props:{adjacentRefs:{type:Array,require:!0}},components:{DetailList:D}},he={key:0},me=s("h3",null,"見よ項目と見よ先項目が隣接しているものがあります！",-1);function fe(c,t,e,n,r,l){const a=R("DetailList");return e.adjacentRefs.length?(o(),i("div",he,[me,h(a,{details:e.adjacentRefs},null,8,["details"])])):g("",!0)}const pe=b(de,[["render",fe]]),_e=s("h2",null,"見よ項目の対応チェック",-1),ve={key:0},ge={__name:"CheckRefs",setup(c){const t=f(""),e=f([]),n=f([]),r=f([]),l=f([]),a=f([]),u=f(""),d=x(()=>q(t.value)),m=x(()=>e.value.length+n.value.length+r.value.length+l.value.length+a.value.length==0),_=()=>{e.value=[],n.value=[],r.value=[],l.value=[],a.value=[],u.value=""},F=()=>{_();const k=new H(d.value);e.value=k.goalLostReference(),n.value=k.requiredFromReference(),r.value=k.findAdjacent();const y=new W(d.value);l.value=y.getUngrouped(),a.value=y.getConflicting(),m.value&&(u.value="問題は見当たりません！ 完璧かもしれません！")};return(k,y)=>(o(),i(v,null,[_e,h(S,{onUpdateContent:y[0]||(y[0]=B=>t.value=B.target.value),onButtonClicked:F}),s("div",null,[h(K,{lostTo:e.value},null,8,["lostTo"]),h(se,{lostFrom:n.value},null,8,["lostFrom"]),h(E,{duplicateRefs:l.value,msg:"見よ項目から参照されている項目の名寄せが不十分です！"},null,8,["duplicateRefs"]),h(E,{duplicateRefs:a.value,msg:"見よ項目が本項目として残っています！"},null,8,["duplicateRefs"]),h(pe,{adjacentRefs:r.value},null,8,["adjacentRefs"]),P(m)?(o(),i("div",ve,p(u.value),1)):g("",!0)])],64))}},be={name:"PossibleList",props:{children:Array}},$e={key:0},ke={key:1};function ye(c,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,$(e.children,(a,u)=>(o(),i("li",{key:u},[s("span",null,[a.pre.length?(o(),i("mark",$e,p(a.pre),1)):g("",!0),C(p(a.rest),1),a.post.length?(o(),i("mark",ke,p(a.post),1)):g("",!0)])]))),128))])}const Re=b(be,[["render",ye]]),Ce={name:"FoundTable",components:{PossibleList:Re},props:{found:Array}},xe={key:0},Le={class:"limit-height"},Fe=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"子項目候補")])],-1);function Ae(c,t,e,n,r,l){const a=R("PossibleList");return e.found.length?(o(),i("div",xe,[s("div",Le,[s("table",null,[Fe,s("tbody",null,[(o(!0),i(v,null,$(e.found,(u,d)=>(o(),i("tr",{key:d},[s("td",null,p(u.parent),1),s("td",null,[h(a,{children:u.children},null,8,["children"])])]))),128))])])])])):g("",!0)}const Te=b(Ce,[["render",Ae]]);class we{constructor(t,e){this.name=t,this.mode=e,this.modified=!1,this.pre="",this.post="",this.rest=""}search(t){(this.mode=="all"||this.mode=="head")&&this.name.startsWith(t)&&(this.pre=t,this.modified=!0),this.rest=this.name.substring(this.pre.length),(this.mode=="all"||this.mode=="tail")&&this.name.endsWith(t)&&(this.post=t,this.modified=!0),this.rest=this.rest.substring(0,this.rest.length-this.post.length)}}class Se{constructor(t,e="tail"){this.mode=e,this.mainEntries=t.filter(n=>String(n).trim()).map(n=>new L(n)).filter(n=>!n.isReference&&!n.isChild).map(n=>({name:n.name,basename:n.basename}))}findPossibles(){return this.mainEntries.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename!=e).map(r=>{const l=new we(r.basename,this.mode);return l.search(e),l.modified?l:null}).filter(Boolean);return{parent:t.name,children:n}}).filter(t=>t.children.length>0).sort((t,e)=>e.parent.length-t.parent.length)}}const qe=s("h2",null,"子項目候補をチェックする",-1),De={__name:"CheckChild",setup(c){const t=f(""),e=f("all"),n=f([]),r=x(()=>q(t.value)),l=()=>{n.value=[]},a=()=>{l();const u=new Se(r.value,e.value);n.value=u.findPossibles()};return(u,d)=>(o(),i(v,null,[qe,h(S,{onUpdateContent:d[0]||(d[0]=m=>t.value=m.target.value),onButtonClicked:a}),s("div",null,[s("label",null,[T(s("input",{type:"radio",value:"tail","onUpdate:modelValue":d[1]||(d[1]=m=>e.value=m)},null,512),[[w,e.value]]),C("末尾一致")]),s("label",null,[T(s("input",{type:"radio",value:"head","onUpdate:modelValue":d[2]||(d[2]=m=>e.value=m)},null,512),[[w,e.value]]),C("先頭一致")]),s("label",null,[T(s("input",{type:"radio",value:"all","onUpdate:modelValue":d[3]||(d[3]=m=>e.value=m)},null,512),[[w,e.value]]),C("両方")])]),h(Te,{found:n.value},null,8,["found"])],64))}};class Ee{constructor(t){const e=new L(t);this.nombres=new j(e.address).nombres,this.problems=[]}checkSort(){if(!(this.nombres.length<2)){for(let t=0;t<this.nombres.length-1;t++)if(this.nombres[t].intValue>=this.nombres[t+1].intValue){this.problems.push({color:"red",text:"順番！"});break}}}checkHyphen(){if(!(this.nombres.length<3))for(let t=0;t<this.nombres.length-2;t++){const e=this.nombres[t],n=this.nombres[t+1],r=this.nombres[t+2];if(e.intValue+1==n.intValue&&e.intValue+2==r.intValue&&!n.hyphenated){this.problems.push({color:"blue",text:"連続！"});break}}}}const V=c=>(U("data-v-d03659ec"),c=c(),I(),c),Ve=V(()=>s("h2",null,"ノンブルの並びをチェックする",-1)),Be=V(()=>s("p",null,"※ノンブルに半角数字以外が含まれている場合は正しく判定できません。",-1)),je={key:0,class:"warning"},Pe={key:1},Ne={__name:"CheckNombre",setup(c){const t=d=>d.filter(m=>String(m).trim()).map(m=>{const _=new Ee(m);return _.checkSort(),_.checkHyphen(),_.problems.length>0?{line:m,detail:_.problems}:null}).filter(Boolean),e=f(""),n=f(""),r=f([]),l=x(()=>q(e.value)),a=()=>{n.value="",r.value=[]},u=()=>{a(),r.value=t(l.value),r.value.length?n.value="修正の必要があります！":n.value="問題は見当たりません！"};return(d,m)=>(o(),i(v,null,[Ve,h(S,{onUpdateContent:m[0]||(m[0]=_=>e.value=_.target.value),onButtonClicked:u}),Be,n.value?(o(),i("strong",je,p(n.value),1)):g("",!0),r.value.length?(o(),i("ul",Pe,[(o(!0),i(v,null,$(r.value,(_,F)=>(o(),i("li",{key:F},[s("span",null,p(_.line),1),(o(!0),i(v,null,$(_.detail,(k,y)=>(o(),i("span",{key:y},[s("span",{style:N({color:k.color})},"←"+p(k.text),5)]))),128))]))),128))])):g("",!0)],64))}},Ue=b(Ne,[["__scopeId","data-v-d03659ec"]]),Ie={class:"check"},He=s("h1",null,"索引のチェック",-1),Oe={__name:"CheckView",setup(c){return(t,e)=>(o(),i("div",Ie,[He,h(ge),h(A),h(De),h(A),h(Ue),h(A)]))}};export{Oe as default};
