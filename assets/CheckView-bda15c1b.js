import{S as D}from"./SectionEnd-92dbd953.js";import{E as F,A as B}from"./entryHandler-ea7f15d2.js";import{P as w}from"./PasteBox-86529bff.js";import{_ as g,o,a as i,e as s,F as v,g as R,t as f,h as b,r as k,b as m,i as p,j as x,u as j,f as y,w as S,l as A,n as N,p as P,d as U}from"./index-b6e9e327.js";class I{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new F(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.referred=this.entries.filter(e=>e.referredFrom.length>0)}goalLostReference(){return this.refs.map(t=>this.nonRefs.filter(n=>n.basename==t.referTo&&n.referredFrom.includes(t.basename)).length>0?null:{problem:t.name,require:`${t.referTo}（${t.basename}）`}).filter(Boolean)}requiredFromReference(){return this.referred.map(t=>{const e=t.referredFrom.filter(n=>this.refs.filter(l=>l.basename==n&&l.referTo==t.basename).length<1);return e.length<1?null:{problem:t.name,require:e.map(n=>`${n}　→${t.basename}`)}}).filter(Boolean)}findAdjacent(){const t=[];return this.entries.forEach((e,n)=>{if(e.isReference){const r=this.entries[n-1];r&&!r.isReference&&r.referredFrom.includes(e.basename)&&t.push(e);const l=this.entries[n+1];l&&!l.isReference&&l.referredFrom.includes(e.basename)&&t.push(e)}}),t.map(e=>e.name)}}class H{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new F(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.mainEntries=this.nonRefs.filter(e=>!e.isChild),this.referred=this.entries.filter(e=>e.referredFrom.length>0),this.nonReferred=this.entries.filter(e=>e.referredFrom.length<1)}getUngrouped(){const t=[];return this.mainEntries.forEach(e=>{const n=e.basename,r=this.mainEntries.filter(l=>l.basename==n);r.length!=1&&(t.map(l=>l.id).includes(n)||t.push({id:n,detail:r.map(l=>l.rawStr)}))}),t.map(e=>e.detail)}getConflicting(){return this.refs.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename==e);return n.length<1?null:[t.name].concat(n.map(r=>r.rawStr))}).filter(Boolean)}}const W={name:"RefLostTo",props:{lostTo:{type:Array,require:!0}}},z={key:0},G=s("h3",null,"見よ項目があるのに参照先に括弧で付記されていないものがあります！",-1),M=s("thead",null,[s("tr",null,[s("th",null,"見よ項目"),s("th",null,"ヌケ")])],-1);function J(d,t,e,n,r,l){return e.lostTo.length?(o(),i("div",z,[G,s("table",null,[M,s("tbody",null,[(o(!0),i(v,null,R(e.lostTo,(a,u)=>(o(),i("tr",{key:u},[s("td",null,f(a.problem),1),s("td",null,f(a.require),1)]))),128))])])])):b("",!0)}const K=g(W,[["render",J]]),O={name:"DetailList",props:{details:{type:Array,require:!0}}};function Q(d,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,R(e.details,(a,u)=>(o(),i("li",{key:u},f(a),1))),128))])}const T=g(O,[["render",Q]]),X={name:"RefLostFrom",props:{lostFrom:{type:Array,require:!0}},components:{DetailList:T}},Y={key:0},Z=s("h3",null,"参照元として括弧書きされているのに見よ項目がないものがあります！",-1),ee=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ヌケ")])],-1);function te(d,t,e,n,r,l){const a=k("DetailList");return e.lostFrom.length?(o(),i("div",Y,[Z,s("table",null,[ee,s("tbody",null,[(o(!0),i(v,null,R(e.lostFrom,(u,c)=>(o(),i("tr",{key:c},[s("td",null,f(u.problem),1),s("td",null,[m(a,{details:u.require},null,8,["details"])])]))),128))])])])):b("",!0)}const ne=g(X,[["render",te]]),se={name:"DuplicateTable",props:{detailsArr:{type:Array,require:!0}},components:{DetailList:T}},re=s("thead",null,[s("tr",null,[s("th",null,"重複項目")])],-1);function le(d,t,e,n,r,l){const a=k("detail-list");return o(),i("table",null,[re,s("tbody",null,[(o(!0),i(v,null,R(e.detailsArr,(u,c)=>(o(),i("tr",{key:c},[s("td",null,[m(a,{details:u},null,8,["details"])])]))),128))])])}const oe=g(se,[["render",le]]),ie={name:"RefDuplicate",props:{msg:{type:String,require:!0},duplicateRefs:{type:Array,require:!0}},components:{DuplicateTable:oe}},ae={key:0};function ue(d,t,e,n,r,l){const a=k("DuplicateTable");return e.duplicateRefs.length?(o(),i("div",ae,[s("h3",null,f(e.msg),1),m(a,{detailsArr:e.duplicateRefs},null,8,["detailsArr"])])):b("",!0)}const E=g(ie,[["render",ue]]),ce={name:"RefAdjacent",props:{adjacentRefs:{type:Array,require:!0}},components:{DetailList:T}},de={key:0},he=s("h3",null,"見よ項目と見よ先項目が隣接しているものがあります！",-1);function me(d,t,e,n,r,l){const a=k("DetailList");return e.adjacentRefs.length?(o(),i("div",de,[he,m(a,{details:e.adjacentRefs},null,8,["details"])])):b("",!0)}const pe=g(ce,[["render",me]]),fe=s("h2",null,"見よ項目の対応チェック",-1),_e={key:0},ve={__name:"CheckRefs",setup(d){const t=p(""),e=p([]),n=p([]),r=p([]),l=p([]),a=p([]),u=p(""),c=x(()=>t.value.split(/\n/).map($=>String($))),h=x(()=>e.value.length+n.value.length+r.value.length+l.value.length+a.value.length==0),_=()=>{e.value=[],n.value=[],r.value=[],l.value=[],a.value=[],u.value=""},L=()=>{_();const $=new I(c.value);e.value=$.goalLostReference(),n.value=$.requiredFromReference(),r.value=$.findAdjacent();const C=new H(c.value);l.value=C.getUngrouped(),a.value=C.getConflicting(),h.value&&(u.value="問題は見当たりません！ 完璧かもしれません！")};return($,C)=>(o(),i(v,null,[fe,m(w,{onUpdateContent:C[0]||(C[0]=q=>t.value=q.target.value),onButtonClicked:L}),s("div",null,[m(K,{lostTo:e.value},null,8,["lostTo"]),m(ne,{lostFrom:n.value},null,8,["lostFrom"]),m(E,{duplicateRefs:l.value,msg:"見よ項目から参照されている項目の名寄せが不十分です！"},null,8,["duplicateRefs"]),m(E,{duplicateRefs:a.value,msg:"見よ項目が本項目として残っています！"},null,8,["duplicateRefs"]),m(pe,{adjacentRefs:r.value},null,8,["adjacentRefs"]),j(h)?(o(),i("div",_e,f(u.value),1)):b("",!0)])],64))}},be={name:"PossibleList",props:{children:Array}},ge={key:0},$e={key:1};function ke(d,t,e,n,r,l){return o(),i("ul",null,[(o(!0),i(v,null,R(e.children,(a,u)=>(o(),i("li",{key:u},[s("span",null,[a.pre.length?(o(),i("mark",ge,f(a.pre),1)):b("",!0),y(f(a.rest),1),a.post.length?(o(),i("mark",$e,f(a.post),1)):b("",!0)])]))),128))])}const Re=g(be,[["render",ke]]),Ce={name:"FoundTable",components:{PossibleList:Re},props:{found:Array}},ye={key:0},xe={class:"limit-height"},Fe=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"子項目候補")])],-1);function Le(d,t,e,n,r,l){const a=k("PossibleList");return e.found.length?(o(),i("div",ye,[s("div",xe,[s("table",null,[Fe,s("tbody",null,[(o(!0),i(v,null,R(e.found,(u,c)=>(o(),i("tr",{key:c},[s("td",null,f(u.parent),1),s("td",null,[m(a,{children:u.children},null,8,["children"])])]))),128))])])])])):b("",!0)}const Se=g(Ce,[["render",Le]]);class Ae{constructor(t,e){this.name=t,this.mode=e,this.modified=!1,this.pre="",this.post="",this.rest=""}search(t){(this.mode=="all"||this.mode=="head")&&this.name.startsWith(t)&&(this.pre=t,this.modified=!0),this.rest=this.name.substring(this.pre.length),(this.mode=="all"||this.mode=="tail")&&this.name.endsWith(t)&&(this.post=t,this.modified=!0),this.rest=this.rest.substring(0,this.rest.length-this.post.length)}}class we{constructor(t,e="tail"){this.mode=e,this.mainEntries=t.filter(n=>String(n).trim()).map(n=>new F(n)).filter(n=>!n.isReference&&!n.isChild).map(n=>({name:n.name,basename:n.basename}))}findPossibles(){return this.mainEntries.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename!=e).map(r=>{const l=new Ae(r.basename,this.mode);return l.search(e),l.modified?l:null}).filter(Boolean);return{parent:t.name,children:n}}).filter(t=>t.children.length>0).sort((t,e)=>e.parent.length-t.parent.length)}}const Te=s("h2",null,"子項目候補をチェックする",-1),Ee={__name:"CheckChild",setup(d){const t=p(""),e=p("all"),n=p([]),r=x(()=>t.value.split(/\n/).map(u=>String(u))),l=()=>{n.value=[]},a=()=>{l();const u=new we(r.value,e.value);n.value=u.findPossibles()};return(u,c)=>(o(),i(v,null,[Te,m(w,{onUpdateContent:c[0]||(c[0]=h=>t.value=h.target.value),onButtonClicked:a}),s("div",null,[s("label",null,[S(s("input",{type:"radio",value:"tail","onUpdate:modelValue":c[1]||(c[1]=h=>e.value=h)},null,512),[[A,e.value]]),y("末尾一致")]),s("label",null,[S(s("input",{type:"radio",value:"head","onUpdate:modelValue":c[2]||(c[2]=h=>e.value=h)},null,512),[[A,e.value]]),y("先頭一致")]),s("label",null,[S(s("input",{type:"radio",value:"all","onUpdate:modelValue":c[3]||(c[3]=h=>e.value=h)},null,512),[[A,e.value]]),y("両方")])]),m(Se,{found:n.value},null,8,["found"])],64))}};class Ve{constructor(t){const e=new F(t);this.nombres=new B(e.address).nombres,this.problems=[]}checkSort(){if(!(this.nombres.length<2)){for(let t=0;t<this.nombres.length-1;t++)if(this.nombres[t].intValue>=this.nombres[t+1].intValue){this.problems.push({color:"red",text:"順番！"});break}}}checkHyphen(){if(!(this.nombres.length<3))for(let t=0;t<this.nombres.length-2;t++){const e=this.nombres[t],n=this.nombres[t+1],r=this.nombres[t+2];if(e.intValue+1==n.intValue&&e.intValue+2==r.intValue&&!n.hyphenated){this.problems.push({color:"blue",text:"連続！"});break}}}}const V=d=>(P("data-v-12abc8d0"),d=d(),U(),d),qe=V(()=>s("h2",null,"ノンブルの並びをチェックする",-1)),De=V(()=>s("p",null,"※ノンブルに半角数字以外が含まれている場合は正しく判定できません。",-1)),Be={key:0,class:"warning"},je={key:1},Ne={__name:"CheckNombre",setup(d){const t=c=>c.filter(h=>String(h).trim()).map(h=>{const _=new Ve(h);return _.checkSort(),_.checkHyphen(),_.problems.length>0?{line:h,detail:_.problems}:null}).filter(Boolean),e=p(""),n=p(""),r=p([]),l=x(()=>e.value.split(/\n/).map(c=>String(c))),a=()=>{n.value="",r.value=[]},u=()=>{a(),r.value=t(l.value),r.value.length?n.value="修正の必要があります！":n.value="問題は見当たりません！"};return(c,h)=>(o(),i(v,null,[qe,m(w,{onUpdateContent:h[0]||(h[0]=_=>e.value=_.target.value),onButtonClicked:u}),De,n.value?(o(),i("strong",Be,f(n.value),1)):b("",!0),r.value.length?(o(),i("ul",je,[(o(!0),i(v,null,R(r.value,(_,L)=>(o(),i("li",{key:L},[s("span",null,f(_.line),1),(o(!0),i(v,null,R(_.detail,($,C)=>(o(),i("span",{key:C},[s("span",{style:N({color:$.color})},"←"+f($.text),5)]))),128))]))),128))])):b("",!0)],64))}},Pe=g(Ne,[["__scopeId","data-v-12abc8d0"]]),Ue={name:"CheckView",components:{SectionEnd:D,CheckRefs:ve,CheckChild:Ee,CheckNombre:Pe}},Ie={class:"check"},He=s("h1",null,"索引のチェック",-1);function We(d,t,e,n,r,l){const a=k("CheckRefs"),u=k("SectionEnd"),c=k("CheckChild"),h=k("CheckNombre");return o(),i("div",Ie,[He,m(a),m(u),m(c),m(u),m(h),m(u)])}const Ke=g(Ue,[["render",We]]);export{Ke as default};
