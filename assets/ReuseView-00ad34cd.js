import{S as T}from"./SectionEnd-7fc4b3d2.js";import{P as L,a as B}from"./PasteBox-3b63b5a3.js";import{R as A}from"./ResultBox-15b67ed3.js";import{_ as F,i as S,j as g,o as m,a as p,b as u,u as _,e as n,t as y,F as w,g as R,h as O,p as j,d as H,f as C,r as x}from"./index-c31636e5.js";import{B as U}from"./BeforeAfter-e87c72b7.js";import{E,A as N}from"./entryHandler-ea7f15d2.js";import{C as W}from"./CopyButton-b84eeed1.js";const D=c=>{const t=String(c).match(/\d[\d,\u2013]*$/);return t?t[0]:""},I=["‐","‑","‒","–","—","―","－","─","-"],q=c=>{let t=c.split(",")[0];return t=t.replace(/\d+$/,""),I.includes(t.at(-1))&&t.at(-2).match(/\d/)&&(t=t.replace(/.$/,""),t=t.replace(/\d+$/,"")),t};class P{constructor(t){this.valiation=I,this.rawStr=t}format(t="–"){let e=this.rawStr;return this.valiation.forEach(s=>{e=e.replaceAll(s,"-")}),e.replace(/\u002d+/g,t)}getHeaderLen(){let t=0;for(let e=0;e<this.rawStr.length&&this.valiation.includes(this.rawStr[e]);e++)t+=1;return t}getTrailerLen(){let t=0;for(let e=this.rawStr.length-1;0<=e&&this.valiation.includes(this.rawStr[e]);e--)t+=1;return t}formatChildEntry(){const t=this.getHeaderLen(),e=t>0?"――":"",s=this.getTrailerLen(),d=s>0?"――":"";return e+this.rawStr.slice(t,this.rawStr.length-s)+d}}class z{constructor(t){this.prefix=t.startsWith(" ")||t.startsWith("　")?"　":"";const e=String(t).replace(/\uff0c/g,",").replace(/\s+/g,""),s=D(new P(e).format());if(s.length>0){this.address=s.replaceAll(",",", "),this.name=q(e);return}if(this.address="",e.indexOf("→")!=-1){this.name=e.replace(/→/,"　→");return}this.name=e}getFormattedLine(){const t=this.prefix+new P(this.name).formatChildEntry();return this.address.length>0?t+"　　"+this.address:t}}const V=c=>(j("data-v-a937757c"),c=c(),H(),c),G=V(()=>n("h2",null,"ゲラから抽出した索引データの整形",-1)),J=V(()=>n("ul",null,[n("li",null,[n("strong",null,"ゲラからテキストを抽出すると長い行が折り返されて改行になっていることがあります。"),n("ul",null,[n("li",null,"そうした箇所は先に手動で整形してください。")])]),n("li",null,"見よ項目の矢印の前のアキを1倍モノに統一します。"),n("li",null,[C("連続するノンブルを示すダーシの種類を"),n("code",null,"–"),C("（enダーシ）に統一します。")]),n("li",null,[C("子項目のダーシの種類を"),n("code",null,"――"),C("（2倍ダーシ）に統一します。")])],-1)),K={key:0},M={class:"detail"},Q={class:"original"},X={class:"formatted"},Y={__name:"FormatOld",setup(c){const t=r=>r.map(a=>String(a).trimEnd().replace(/\t/,"　　")).map(a=>({formatted:new z(a).getFormattedLine(),original:a})),e=S(""),s=S([]),d=S(""),v=g(()=>B(e.value)),f=g(()=>s.value.map(r=>r.formatted).join(`
`)),l=g(()=>s.value.filter(r=>r.formatted!=r.original)),i=()=>{s.value=[]},o=()=>{i(),s.value=t(v.value),l.value.length>0?d.value=l.value.length+"箇所を修正しました！":d.value="問題のある箇所は見当たりませんでした！"};return(r,a)=>(m(),p(w,null,[G,u(L,{onUpdateContent:a[0]||(a[0]=h=>e.value=h.target.value),onButtonClicked:o}),J,u(A,{result:_(f)},null,8,["result"]),n("div",null,[n("h4",null,y(d.value),1),_(l).length?(m(),p("ol",K,[(m(!0),p(w,null,R(_(l),(h,b)=>(m(),p("li",{key:b},[n("ul",M,[n("li",Q,y(h.original),1),n("li",X,y(h.formatted),1)])]))),128))])):O("",!0)])],64))}},Z=F(Y,[["__scopeId","data-v-a937757c"]]),tt="/sakuin-tool/assets/before-553b588b.png",et="/sakuin-tool/assets/after-cef2c7b2.png",nt=n("h2",null,"子項目の復元",-1),rt={__name:"ResolveChild",setup(c){const t=o=>{const r=[],a=[];r.push(o[0]),a.push(new E(o[0]).basename);for(let h=1;h<o.length;h++){const b=new E(o[h]),$=b.basename;if($.startsWith("――")){const k=a.at(-1)+$.substring(2);r.push(k+"　　"+b.address)}else if($.endsWith("――")){const k=$.substring(0,$.length-2)+a.at(-1);r.push(k+"　　"+b.address)}else r.push(b.rawStr),a.push($)}return r},e=S(""),s=S([]),d=g(()=>B(e.value)),v=g(()=>d.value.map(o=>o.trim()).filter(o=>o.length)),f=g(()=>s.value.join(`
`)),l=()=>{s.value=[]},i=()=>{l(),s.value=t(v.value)};return(o,r)=>(m(),p(w,null,[nt,u(U,{beforePath:_(tt),afterPath:_(et)},null,8,["beforePath","afterPath"]),u(L,{onUpdateContent:r[0]||(r[0]=a=>e.value=a.target.value),onButtonClicked:i}),u(A,{result:_(f)},null,8,["result"])],64))}},st="/sakuin-tool/assets/before-e62df1a7.png",ot="/sakuin-tool/assets/after-49f03dfc.png",at={name:"UngroupedTable",props:{lines:Array,resultStr:String},components:{CopyButton:W}},lt={key:0},ut={class:"limit-height"},ct=n("thead",null,[n("tr",null,[n("th",null,"項目"),n("th",null,"ノンブル")])],-1);function it(c,t,e,s,d,v){const f=x("CopyButton");return e.lines.length?(m(),p("div",lt,[n("div",ut,[n("table",null,[ct,n("tbody",null,[(m(!0),p(w,null,R(e.lines,(l,i)=>(m(),p("tr",{key:i},[n("td",null,y(l.name),1),n("td",null,y(l.nombre),1)]))),128))])])]),u(f,{copyStr:e.resultStr},null,8,["copyStr"])])):O("",!0)}const dt=F(at,[["render",it]]),ht=n("h2",null,"名開き",-1),mt=n("p",null,"※項目とノンブルが Excel 上で2列に分かれていても大丈夫です。",-1),pt={__name:"Ungroup",setup(c){const t=i=>{const o=[];return i.filter(r=>r.trim()).map(r=>r.replace("	","　　")).forEach(r=>{const a=new E(r);a.isReference?o.push({name:a.name,nombre:""}):new N(a.address).nombres.forEach(h=>{o.push({name:a.name,nombre:h.display.text})})}),o},e=S(""),s=S([]),d=g(()=>B(e.value)),v=g(()=>s.value.map(i=>`${i.name}	${i.nombre}`.trimEnd()).join(`
`)),f=()=>{s.value=[]},l=()=>{f(),s.value=t(d.value)};return(i,o)=>(m(),p(w,null,[ht,u(U,{beforePath:_(st),afterPath:_(ot)},null,8,["beforePath","afterPath"]),mt,u(L,{onUpdateContent:o[0]||(o[0]=r=>e.value=r.target.value),onButtonClicked:l}),u(dt,{lines:s.value,resultStr:_(v)},null,8,["lines","resultStr"])],64))}},ft={name:"ReuseView",components:{SectionEnd:T,FormatOld:Z,ResolveChild:rt,Ungroup:pt}},_t={class:"reuse"},gt=n("h1",null,"旧版索引の再利用",-1);function vt(c,t,e,s,d,v){const f=x("FormatOld"),l=x("SectionEnd"),i=x("ResolveChild"),o=x("Ungroup");return m(),p("div",_t,[gt,u(f),u(l),u(i),u(l),u(o),u(l)])}const kt=F(ft,[["render",vt]]);export{kt as default};
