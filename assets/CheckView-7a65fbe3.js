import{P as L,S as A}from"./PasteBox-cc179bc6.js";import{E as k,A as B}from"./entryHandler-ea7f15d2.js";import{_,o,a as i,d as s,F as m,e as b,t as f,r as p,b as h,f as g,g as F,w as C,j as y,n as S,p as w,i as j}from"./index-c539dc66.js";class P{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new k(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.referred=this.entries.filter(e=>e.referredFrom.length>0)}goalLostReference(){return this.refs.map(t=>this.nonRefs.filter(r=>r.basename==t.referTo&&r.referredFrom.includes(t.basename)).length>0?null:{problem:t.name,require:`${t.referTo}（${t.basename}）`}).filter(Boolean)}requiredFromReference(){return this.referred.map(t=>{const e=t.referredFrom.filter(r=>this.refs.filter(l=>l.basename==r&&l.referTo==t.basename).length<1);return e.length<1?null:{problem:t.name,require:e.map(r=>`${r}　→${t.basename}`)}}).filter(Boolean)}findAdjacent(){const t=[];return this.entries.forEach((e,r)=>{if(e.isReference){const a=this.entries[r-1];a&&!a.isReference&&a.referredFrom.includes(e.basename)&&t.push(e);const l=this.entries[r+1];l&&!l.isReference&&l.referredFrom.includes(e.basename)&&t.push(e)}}),t.map(e=>e.name)}}class D{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new k(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.mainEntries=this.nonRefs.filter(e=>!e.isChild),this.referred=this.entries.filter(e=>e.referredFrom.length>0),this.nonReferred=this.entries.filter(e=>e.referredFrom.length<1)}getUngrouped(){const t=[];return this.mainEntries.forEach(e=>{const r=e.basename,a=this.mainEntries.filter(l=>l.basename==r);a.length!=1&&(t.map(l=>l.id).includes(r)||t.push({id:r,detail:a.map(l=>l.rawStr)}))}),t.map(e=>e.detail)}getConflicting(){return this.refs.map(t=>{const e=t.basename,r=this.mainEntries.filter(a=>a.basename==e);return r.length<1?null:[t.name].concat(r.map(a=>a.rawStr))}).filter(Boolean)}}const V={name:"RefLostTo",props:{lostTo:{type:Array,require:!0}}},q=s("h3",null,"見よ項目があるのに参照先に括弧で付記されていないものがあります！",-1),N=s("thead",null,[s("tr",null,[s("th",null,"見よ項目"),s("th",null,"ヌケ")])],-1);function x(n,t,e,r,a,l){return o(),i(m,null,[q,s("table",null,[N,s("tbody",null,[(o(!0),i(m,null,b(e.lostTo,(c,u)=>(o(),i("tr",{key:u},[s("td",null,f(c.problem),1),s("td",null,f(c.require),1)]))),128))])])],64)}const U=_(V,[["render",x]]),I={name:"DetailList",props:{details:{type:Array,require:!0}}};function H(n,t,e,r,a,l){return o(),i("ul",null,[(o(!0),i(m,null,b(e.details,(c,u)=>(o(),i("li",{key:u},f(c),1))),128))])}const v=_(I,[["render",H]]),W={name:"RefLostFrom",props:{lostFrom:{type:Array,require:!0}},components:{DetailList:v}},z=s("h3",null,"参照元として括弧書きされているのに見よ項目がないものがあります！",-1),G=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ヌケ")])],-1);function M(n,t,e,r,a,l){const c=p("DetailList");return o(),i(m,null,[z,s("table",null,[G,s("tbody",null,[(o(!0),i(m,null,b(e.lostFrom,(u,d)=>(o(),i("tr",{key:d},[s("td",null,f(u.problem),1),s("td",null,[h(c,{details:u.require},null,8,["details"])])]))),128))])])],64)}const J=_(W,[["render",M]]),K={name:"DuplicateTable",props:{detailsArr:{type:Array,require:!0}},components:{DetailList:v}},O=s("thead",null,[s("tr",null,[s("th",null,"重複項目")])],-1);function Q(n,t,e,r,a,l){const c=p("detail-list");return o(),i("table",null,[O,s("tbody",null,[(o(!0),i(m,null,b(e.detailsArr,(u,d)=>(o(),i("tr",{key:d},[s("td",null,[h(c,{details:u},null,8,["details"])])]))),128))])])}const X=_(K,[["render",Q]]),Y={name:"RefDuplicate",props:{msg:{type:String,require:!0},duplicateRefs:{type:Array,require:!0}},components:{DuplicateTable:X}};function Z(n,t,e,r,a,l){const c=p("DuplicateTable");return o(),i(m,null,[s("h3",null,f(e.msg),1),h(c,{detailsArr:e.duplicateRefs},null,8,["detailsArr"])],64)}const ee=_(Y,[["render",Z]]),te={name:"RefAdjacent",props:{adjacentRefs:{type:Array,require:!0}},components:{DetailList:v}},ne=s("h3",null,"見よ項目と見よ先項目が隣接しているものがあります！",-1);function se(n,t,e,r,a,l){const c=p("DetailList");return o(),i(m,null,[ne,h(c,{details:e.adjacentRefs},null,8,["details"])],64)}const re=_(te,[["render",se]]),oe={name:"CheckRefs",data:function(){return{content:"",lostTo:[],lostFrom:[],adjacent:[],ungrouped:[],conflicts:[],message:""}},components:{PasteBox:L,RefLostTo:U,RefLostFrom:J,RefDuplicate:ee,RefAdjacent:re},computed:{contentLines:function(){return this.content.split(/\n/).map(n=>String(n))},isPerfect:function(){return this.lostTo.length+this.lostFrom.length+this.adjacent.length+this.ungrouped.length+this.conflicts.length==0}},methods:{reset:function(){this.lostTo=[],this.lostFrom=[],this.adjacent=[],this.ungrouped=[],this.conflicts=[],this.message=""},executeCheck:function(){this.reset();const n=new P(this.contentLines);n.goalLostReference().forEach(e=>{this.lostTo.push(e)}),n.requiredFromReference().forEach(e=>{this.lostFrom.push(e)}),n.findAdjacent().forEach(e=>{this.adjacent.push(e)});const t=new D(this.contentLines);t.getUngrouped().forEach(e=>{this.ungrouped.push(e)}),t.getConflicting().forEach(e=>{this.conflicts.push(e)}),this.isPerfect&&(this.message="問題は見当たりません！ 完璧かもしれません！")}}},ie=s("h2",null,"見よ項目の対応チェック",-1),le={key:0},ae={key:1},ce={key:2},ue={key:3},he={key:4},de={key:5};function pe(n,t,e,r,a,l){const c=p("PasteBox"),u=p("RefLostTo"),d=p("RefLostFrom"),$=p("RefDuplicate"),R=p("RefAdjacent");return o(),i(m,null,[ie,h(c,{onUpdateContent:t[0]||(t[0]=E=>n.content=E.target.value),onButtonClicked:l.executeCheck},null,8,["onButtonClicked"]),s("div",null,[n.lostTo.length?(o(),i("div",le,[h(u,{lostTo:n.lostTo},null,8,["lostTo"])])):g("",!0),n.lostFrom.length?(o(),i("div",ae,[h(d,{lostFrom:n.lostFrom},null,8,["lostFrom"])])):g("",!0),n.ungrouped.length?(o(),i("div",ce,[h($,{duplicateRefs:n.ungrouped,msg:"見よ項目から参照されている項目の名寄せが不十分です！"},null,8,["duplicateRefs"])])):g("",!0),n.conflicts.length?(o(),i("div",ue,[h($,{duplicateRefs:n.conflicts,msg:"見よ項目が本項目として残っています！"},null,8,["duplicateRefs"])])):g("",!0),n.adjacent.length?(o(),i("div",he,[h(R,{adjacentRefs:n.adjacent},null,8,["adjacentRefs"])])):g("",!0),l.isPerfect?(o(),i("div",de,f(n.message),1)):g("",!0)])],64)}const me=_(oe,[["render",pe]]),fe={name:"PossibleList",props:{children:Array}},_e={key:0},ge={key:1};function be(n,t,e,r,a,l){return o(),i("ul",null,[(o(!0),i(m,null,b(e.children,(c,u)=>(o(),i("li",{key:u},[s("span",null,[c.pre.length?(o(),i("mark",_e,f(c.pre),1)):g("",!0),F(f(c.rest),1),c.post.length?(o(),i("mark",ge,f(c.post),1)):g("",!0)])]))),128))])}const $e=_(fe,[["render",be]]),ke={name:"FoundTable",components:{PossibleList:$e},props:{found:Array}},Re={key:0},Ce={class:"limit-height"},ye=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"子項目候補")])],-1);function Fe(n,t,e,r,a,l){const c=p("PossibleList");return e.found.length?(o(),i("div",Re,[s("div",Ce,[s("table",null,[ye,s("tbody",null,[(o(!0),i(m,null,b(e.found,(u,d)=>(o(),i("tr",{key:d},[s("td",null,f(u.parent),1),s("td",null,[h(c,{children:u.children},null,8,["children"])])]))),128))])])])])):g("",!0)}const Le=_(ke,[["render",Fe]]);class ve{constructor(t,e){this.name=t,this.mode=e,this.modified=!1,this.pre="",this.post="",this.rest=""}search(t){(this.mode=="all"||this.mode=="head")&&this.name.startsWith(t)&&(this.pre=t,this.modified=!0),this.rest=this.name.substring(this.pre.length),(this.mode=="all"||this.mode=="tail")&&this.name.endsWith(t)&&(this.post=t,this.modified=!0),this.rest=this.rest.substring(0,this.rest.length-this.post.length)}}let Te=class{constructor(t,e="tail"){this.mode=e,this.mainEntries=t.filter(r=>String(r).trim()).map(r=>new k(r)).filter(r=>!r.isReference&&!r.isChild).map(r=>({name:r.name,basename:r.basename}))}findPossibles(){return this.mainEntries.map(t=>{const e=t.basename,r=this.mainEntries.filter(a=>a.basename!=e).map(a=>{const l=new ve(a.basename,this.mode);return l.search(e),l.modified?l:null}).filter(Boolean);return{parent:t.name,children:r}}).filter(t=>t.children.length>0).sort((t,e)=>e.parent.length-t.parent.length)}};const Ee={name:"CheckChild",data:function(){return{content:"",picked:"all",found:[]}},components:{PasteBox:L,FoundTable:Le},computed:{contentLines:function(){return this.content.split(/\n/).map(n=>String(n))}},methods:{reset:function(){this.found=[]},executeCheck:function(){this.reset(),new Te(this.contentLines,this.picked).findPossibles().forEach(t=>{this.found.push(t)})}}},Ae=s("h2",null,"子項目候補をチェックする",-1),Be=s("label",{for:"search-tail"},"末尾一致",-1),Se=s("label",{for:"search-head"},"先頭一致",-1),we=s("label",{for:"search-all"},"両方",-1);function je(n,t,e,r,a,l){const c=p("PasteBox"),u=p("FoundTable");return o(),i(m,null,[Ae,h(c,{onUpdateContent:t[0]||(t[0]=d=>n.content=d.target.value),onButtonClicked:l.executeCheck},null,8,["onButtonClicked"]),s("div",null,[C(s("input",{type:"radio",id:"search-tail",value:"tail","onUpdate:modelValue":t[1]||(t[1]=d=>n.picked=d)},null,512),[[y,n.picked]]),Be,F(),C(s("input",{type:"radio",id:"search-head",value:"head","onUpdate:modelValue":t[2]||(t[2]=d=>n.picked=d)},null,512),[[y,n.picked]]),Se,F(),C(s("input",{type:"radio",id:"search-all",value:"all","onUpdate:modelValue":t[3]||(t[3]=d=>n.picked=d)},null,512),[[y,n.picked]]),we]),h(u,{found:n.found},null,8,["found"])],64)}const Pe=_(Ee,[["render",je]]);class De{constructor(t){const e=new k(t);this.nombres=new B(e.address).nombres,this.problems=[]}checkSort(){if(!(this.nombres.length<2)){for(let t=0;t<this.nombres.length-1;t++)if(this.nombres[t].intValue>=this.nombres[t+1].intValue){this.problems.push({color:"red",text:"順番！"});break}}}checkHyphen(){if(!(this.nombres.length<3))for(let t=0;t<this.nombres.length-2;t++){const e=this.nombres[t],r=this.nombres[t+1],a=this.nombres[t+2];if(e.intValue+1==r.intValue&&e.intValue+2==a.intValue&&!r.hyphenated){this.problems.push({color:"blue",text:"連続！"});break}}}}const Ve=n=>n.filter(t=>String(t).trim()).map(t=>{const e=new De(t);return e.checkSort(),e.checkHyphen(),e.problems.length>0?{line:t,detail:e.problems}:null}).filter(Boolean),qe={name:"CheckNomble",data:function(){return{content:"",message:"",problems:[]}},components:{PasteBox:L},computed:{contentLines:function(){return this.content.split(/\n/).map(n=>String(n))}},methods:{reset:function(){this.message="",this.problems=[]},executeCheck:function(){this.reset(),Ve(this.contentLines).forEach(n=>{this.problems.push(n)}),this.problems.length?this.message="修正の必要があります！":this.message="問題は見当たりません！"}}},T=n=>(w("data-v-a4e113a9"),n=n(),j(),n),Ne=T(()=>s("h2",null,"ノンブルの並びをチェックする",-1)),xe=T(()=>s("p",null,[s("strong",null,"ノンブルに半角数字以外が含まれている場合は正しく判定できません。")],-1)),Ue={key:0,class:"warning"},Ie={key:1};function He(n,t,e,r,a,l){const c=p("PasteBox");return o(),i(m,null,[Ne,h(c,{onUpdateContent:t[0]||(t[0]=u=>n.content=u.target.value),onButtonClicked:l.executeCheck},null,8,["onButtonClicked"]),xe,n.message?(o(),i("strong",Ue,f(n.message),1)):g("",!0),n.problems.length?(o(),i("ul",Ie,[(o(!0),i(m,null,b(n.problems,(u,d)=>(o(),i("li",{key:d},[s("span",null,f(u.line),1),(o(!0),i(m,null,b(u.detail,($,R)=>(o(),i("span",{key:R},[s("span",{style:S({color:$.color})},"←"+f($.text),5)]))),128))]))),128))])):g("",!0)],64)}const We=_(qe,[["render",He],["__scopeId","data-v-a4e113a9"]]),ze={name:"CheckView",components:{SectionEnd:A,CheckRefs:me,CheckChild:Pe,CheckNombre:We}},Ge={class:"check"},Me=s("h1",null,"索引のチェック",-1);function Je(n,t,e,r,a,l){const c=p("CheckRefs"),u=p("SectionEnd"),d=p("CheckChild"),$=p("CheckNombre");return o(),i("div",Ge,[Me,h(c),h(u),h(d),h(u),h($),h(u)])}const Ye=_(ze,[["render",Je]]);export{Ye as default};
