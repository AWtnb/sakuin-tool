import{S as L}from"./SectionEnd-8182a5cf.js";import{P as E,a as T}from"./PasteBox-4fcc499f.js";import{E as x,A as U}from"./entryHandler-ea7f15d2.js";import{_ as A,i as m,o as l,a,e as s,w as R,v as q,f as y,l as N,h as g,b as u,m as F,F as v,g as b,t as _,j as C,u as D,r as H,n as V,q as M,p as W,d as z}from"./index-025c3689.js";class G{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new x(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.referred=this.entries.filter(e=>e.referredFrom.length>0)}goalLostReference(){return this.refs.map(t=>this.nonRefs.filter(n=>n.basename==t.referTo&&n.referredFrom.includes(t.basename)).length>0?null:{problem:t.name,require:`${t.referTo}（${t.basename}）`}).filter(Boolean)}requiredFromReference(){return this.referred.map(t=>{const e=t.referredFrom.filter(n=>this.refs.filter(i=>i.basename==n&&i.referTo==t.basename).length<1);return e.length<1?null:{problem:t.name,require:e.map(n=>`${n}　→${t.basename}`)}}).filter(Boolean)}findAdjacent(){const t=[];return this.entries.forEach((e,n)=>{if(e.isReference){const r=this.entries[n-1];r&&!r.isReference&&r.referredFrom.includes(e.basename)&&t.push(e);const i=this.entries[n+1];i&&!i.isReference&&i.referredFrom.includes(e.basename)&&t.push(e)}}),t.map(e=>e.name)}}class O{constructor(t){this.entries=t.filter(e=>String(e).trim()).map(e=>new x(e)),this.refs=this.entries.filter(e=>e.isReference),this.nonRefs=this.entries.filter(e=>!e.isReference),this.mainEntries=this.nonRefs.filter(e=>!e.isChild),this.referred=this.entries.filter(e=>e.referredFrom.length>0),this.nonReferred=this.entries.filter(e=>e.referredFrom.length<1)}getUngrouped(){const t=[];return this.mainEntries.forEach(e=>{const n=e.basename,r=this.mainEntries.filter(i=>i.basename==n);r.length!=1&&(t.map(i=>i.id).includes(n)||t.push({id:n,detail:r.map(i=>i.rawStr)}))}),t.map(e=>e.detail)}getConflicting(){return this.refs.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename==e);return n.length<1?null:[t.name].concat(n.map(r=>r.rawStr))}).filter(Boolean)}}const J={class:"area"},K={key:0},Q={__name:"IgnorableArea",setup(o){const t=m(!1);return(e,n)=>(l(),a("div",J,[s("label",null,[R(s("input",{type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=r=>t.value=r)},null,512),[[q,t.value]]),y("無視する")]),t.value?g("",!0):(l(),a("div",K,[N(e.$slots,"default",{},void 0,!0)]))]))}},w=A(Q,[["__scopeId","data-v-22fa23f4"]]),X={key:0},Y=s("h3",null,"見よ先の括弧書きが足りません：",-1),Z=s("thead",null,[s("tr",null,[s("th",null,"見よ項目"),s("th",null,"ヌケ")])],-1),ee={__name:"RefLostTo",props:{lostTo:Array},setup(o){return(t,e)=>o.lostTo.length?(l(),a("div",X,[Y,u(w,null,{default:F(()=>[s("table",null,[Z,s("tbody",null,[(l(!0),a(v,null,b(o.lostTo,(n,r)=>(l(),a("tr",{key:r},[s("td",null,_(n.problem),1),s("td",null,_(n.require),1)]))),128))])])]),_:1})])):g("",!0)}},B={__name:"DetailList",props:{details:Array},setup(o){return(t,e)=>(l(),a("ul",null,[(l(!0),a(v,null,b(o.details,(n,r)=>(l(),a("li",{key:r},_(n),1))),128))]))}},te={key:0},ne=s("h3",null,"見よ項目が足りません：",-1),se=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"ヌケ")])],-1),re={__name:"RefLostFrom",props:{lostFrom:Array},setup(o){return(t,e)=>o.lostFrom.length?(l(),a("div",te,[ne,u(w,null,{default:F(()=>[s("table",null,[se,s("tbody",null,[(l(!0),a(v,null,b(o.lostFrom,(n,r)=>(l(),a("tr",{key:r},[s("td",null,_(n.problem),1),s("td",null,[u(B,{details:n.require},null,8,["details"])])]))),128))])])]),_:1})])):g("",!0)}},le=s("thead",null,[s("tr",null,[s("th",null,"重複項目")])],-1),ae={__name:"DuplicateTable",props:{detailsArr:Array},setup(o){return(t,e)=>(l(),a("table",null,[le,s("tbody",null,[(l(!0),a(v,null,b(o.detailsArr,(n,r)=>(l(),a("tr",{key:r},[s("td",null,[u(B,{details:n},null,8,["details"])])]))),128))])]))}},oe={key:0},j={__name:"RefDuplicate",props:{msg:String,duplicateRefs:Array},setup(o){return(t,e)=>o.duplicateRefs.length?(l(),a("div",oe,[s("h3",null,_(o.msg),1),u(w,null,{default:F(()=>[u(ae,{detailsArr:o.duplicateRefs},null,8,["detailsArr"])]),_:1})])):g("",!0)}},ie={key:0},ue=s("h3",null,"見よ項目のすぐ隣に見よ先項目があります：",-1),ce={__name:"RefAdjacent",props:{adjacentRefs:Array},setup(o){return(t,e)=>o.adjacentRefs.length?(l(),a("div",ie,[ue,u(w,null,{default:F(()=>[u(B,{details:o.adjacentRefs},null,8,["details"])]),_:1})])):g("",!0)}},de=s("h2",null,"見よ項目の対応チェック",-1),he={key:0},me={__name:"CheckRefs",setup(o){const t=m(""),e=m([]),n=m([]),r=m([]),i=m([]),d=m([]),f=m(""),h=C(()=>T(t.value)),c=C(()=>e.value.length+n.value.length+r.value.length+i.value.length+d.value.length==0),p=()=>{e.value=[],n.value=[],r.value=[],i.value=[],d.value=[],f.value=""},S=()=>{p();const k=new G(h.value);e.value=k.goalLostReference(),n.value=k.requiredFromReference(),r.value=k.findAdjacent();const $=new O(h.value);i.value=$.getUngrouped(),d.value=$.getConflicting(),c.value&&(f.value="問題は見当たりません！ 完璧かもしれません！")};return(k,$)=>(l(),a(v,null,[de,u(E,{onUpdateContent:$[0]||($[0]=P=>t.value=P.target.value),onButtonClicked:S}),s("div",null,[u(ee,{lostTo:e.value},null,8,["lostTo"]),u(re,{lostFrom:n.value},null,8,["lostFrom"]),u(j,{duplicateRefs:i.value,msg:"名寄せが不十分です："},null,8,["duplicateRefs"]),u(j,{duplicateRefs:d.value,msg:"見よ項目が本項目として残っています："},null,8,["duplicateRefs"]),u(ce,{adjacentRefs:r.value},null,8,["adjacentRefs"]),D(c)?(l(),a("div",he,_(f.value),1)):g("",!0)])],64))}},fe={name:"PossibleList",props:{children:Array}},_e={key:0},pe={key:1};function ve(o,t,e,n,r,i){return l(),a("ul",null,[(l(!0),a(v,null,b(e.children,(d,f)=>(l(),a("li",{key:f},[s("span",null,[d.pre.length?(l(),a("mark",_e,_(d.pre),1)):g("",!0),y(_(d.rest),1),d.post.length?(l(),a("mark",pe,_(d.post),1)):g("",!0)])]))),128))])}const ge=A(fe,[["render",ve]]),be={name:"FoundTable",components:{PossibleList:ge},props:{found:Array}},ke={key:0},$e={class:"limit-height"},ye=s("thead",null,[s("tr",null,[s("th",null,"項目"),s("th",null,"子項目候補")])],-1);function Re(o,t,e,n,r,i){const d=H("PossibleList");return e.found.length?(l(),a("div",ke,[s("div",$e,[s("table",null,[ye,s("tbody",null,[(l(!0),a(v,null,b(e.found,(f,h)=>(l(),a("tr",{key:h},[s("td",null,_(f.parent),1),s("td",null,[u(d,{children:f.children},null,8,["children"])])]))),128))])])])])):g("",!0)}const Ce=A(be,[["render",Re]]);class xe{constructor(t,e){this.name=t,this.mode=e,this.modified=!1,this.pre="",this.post="",this.rest=""}search(t){(this.mode=="all"||this.mode=="head")&&this.name.startsWith(t)&&(this.pre=t,this.modified=!0),this.rest=this.name.substring(this.pre.length),(this.mode=="all"||this.mode=="tail")&&this.name.endsWith(t)&&(this.post=t,this.modified=!0),this.rest=this.rest.substring(0,this.rest.length-this.post.length)}}class Ae{constructor(t,e="tail"){this.mode=e,this.mainEntries=t.filter(n=>String(n).trim()).map(n=>new x(n)).filter(n=>!n.isReference&&!n.isChild).map(n=>({name:n.name,basename:n.basename}))}findPossibles(){return this.mainEntries.map(t=>{const e=t.basename,n=this.mainEntries.filter(r=>r.basename!=e).map(r=>{const i=new xe(r.basename,this.mode);return i.search(e),i.modified?i:null}).filter(Boolean);return{parent:t.name,children:n}}).filter(t=>t.children.length>0).sort((t,e)=>e.parent.length-t.parent.length)}}const Fe=s("h2",null,"子項目候補をチェックする",-1),we={__name:"CheckChild",setup(o){const t=m(""),e=m("all"),n=m([]),r=C(()=>T(t.value)),i=()=>{n.value=[]},d=()=>{i();const f=new Ae(r.value,e.value);n.value=f.findPossibles()};return(f,h)=>(l(),a(v,null,[Fe,u(E,{onUpdateContent:h[0]||(h[0]=c=>t.value=c.target.value),onButtonClicked:d}),s("div",null,[s("label",null,[R(s("input",{type:"radio",value:"tail","onUpdate:modelValue":h[1]||(h[1]=c=>e.value=c)},null,512),[[V,e.value]]),y("末尾一致")]),s("label",null,[R(s("input",{type:"radio",value:"head","onUpdate:modelValue":h[2]||(h[2]=c=>e.value=c)},null,512),[[V,e.value]]),y("先頭一致")]),s("label",null,[R(s("input",{type:"radio",value:"all","onUpdate:modelValue":h[3]||(h[3]=c=>e.value=c)},null,512),[[V,e.value]]),y("両方")])]),u(Ce,{found:n.value},null,8,["found"])],64))}};class Se{constructor(t){const e=new x(t);this.nombres=new U(e.address).nombres,this.problems=[]}checkSort(){if(!(this.nombres.length<2)){for(let t=0;t<this.nombres.length-1;t++)if(this.nombres[t].intValue>=this.nombres[t+1].intValue){this.problems.push({color:"red",text:"順番！"});break}}}checkHyphen(){if(!(this.nombres.length<3))for(let t=0;t<this.nombres.length-2;t++){const e=this.nombres[t],n=this.nombres[t+1],r=this.nombres[t+2];if(e.intValue+1==n.intValue&&e.intValue+2==r.intValue&&!n.hyphenated){this.problems.push({color:"blue",text:"連続！"});break}}}}const I=o=>(W("data-v-d03659ec"),o=o(),z(),o),Le=I(()=>s("h2",null,"ノンブルの並びをチェックする",-1)),Ve=I(()=>s("p",null,"※ノンブルに半角数字以外が含まれている場合は正しく判定できません。",-1)),Ee={key:0,class:"warning"},Te={key:1},Be={__name:"CheckNombre",setup(o){const t=h=>h.filter(c=>String(c).trim()).map(c=>{const p=new Se(c);return p.checkSort(),p.checkHyphen(),p.problems.length>0?{line:c,detail:p.problems}:null}).filter(Boolean),e=m(""),n=m(""),r=m([]),i=C(()=>T(e.value)),d=()=>{n.value="",r.value=[]},f=()=>{d(),r.value=t(i.value),r.value.length?n.value="修正の必要があります！":n.value="問題は見当たりません！"};return(h,c)=>(l(),a(v,null,[Le,u(E,{onUpdateContent:c[0]||(c[0]=p=>e.value=p.target.value),onButtonClicked:f}),Ve,n.value?(l(),a("strong",Ee,_(n.value),1)):g("",!0),r.value.length?(l(),a("ul",Te,[(l(!0),a(v,null,b(r.value,(p,S)=>(l(),a("li",{key:S},[s("span",null,_(p.line),1),(l(!0),a(v,null,b(p.detail,(k,$)=>(l(),a("span",{key:$},[s("span",{style:M({color:k.color})},"←"+_(k.text),5)]))),128))]))),128))])):g("",!0)],64))}},je=A(Be,[["__scopeId","data-v-d03659ec"]]),Ie={class:"check"},Pe=s("h1",null,"索引のチェック",-1),He={__name:"CheckView",setup(o){return(t,e)=>(l(),a("div",Ie,[Pe,u(me),u(L),u(we),u(L),u(je),u(L)]))}};export{He as default};
