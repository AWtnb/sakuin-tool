import{P as x,S as E}from"./PasteBox-9cbf9a1f.js";import{R as v}from"./ResultBox-fce590ed.js";import{_,r as d,o as m,a as h,b as l,d as r,t as p,F as f,e as L,f as C,p as k,i as A,g}from"./index-a0b0fe72.js";import{E as $,A as F}from"./entryHandler-ea7f15d2.js";import{C as w}from"./CopyButton-b9b52950.js";const R=e=>{const t=String(e).match(/\d[\d,\u2013]*$/);return t?t[0]:""},b=["‐","‑","‒","–","—","―","－","─","-"],U=e=>{let t=e.split(",")[0];return t=t.replace(/\d+$/,""),b.includes(t.at(-1))&&t.at(-2).match(/\d/)&&(t=t.replace(/.$/,""),t=t.replace(/\d+$/,"")),t};class B{constructor(t){this.valiation=b,this.rawStr=t}format(t="–"){let n=this.rawStr;return this.valiation.forEach(s=>{n=n.replaceAll(s,"-")}),n.replace(/\u002d+/g,t)}getHeaderLen(){let t=0;for(let n=0;n<this.rawStr.length&&this.valiation.includes(this.rawStr[n]);n++)t+=1;return t}getTrailerLen(){let t=0;for(let n=this.rawStr.length-1;0<=n&&this.valiation.includes(this.rawStr[n]);n--)t+=1;return t}formatChildEntry(){const t=this.getHeaderLen(),n=t>0?"――":"",s=this.getTrailerLen(),i=s>0?"――":"";return n+this.rawStr.slice(t,this.rawStr.length-s)+i}}class O{constructor(t){this.prefix=t.startsWith(" ")||t.startsWith("　")?"　":"";const n=String(t).replace(/\uff0c/g,",").replace(/\s+/g,""),s=R(new B(n).format());if(s.length>0){this.address=s.replaceAll(",",", "),this.name=U(n);return}if(this.address="",n.indexOf("→")!=-1){this.name=n.replace(/→/,"　→");return}this.name=n}getFormattedLine(){const t=this.prefix+new B(this.name).formatChildEntry();return this.address.length>0?t+"　　"+this.address:t}}const P=e=>e.map(t=>String(t).trimEnd().replace(/\t/,"　　")).map(t=>({formatted:new O(t).getFormattedLine(),original:t})),T={name:"FormatOld",data:function(){return{content:"",fmtArr:[],message:""}},components:{PasteBox:x,ResultBox:v},computed:{contentLines:function(){return this.content.split(/\n/).map(e=>String(e))},resultStr:function(){return this.fmtArr.map(e=>e.formatted).join(`
`)},modified:function(){return this.fmtArr.filter(e=>e.formatted!=e.original)}},methods:{reset:function(){this.fmtArr=[]},executeFormat:function(){this.reset(),P(this.contentLines).forEach(e=>{this.fmtArr.push(e)}),this.modified.length>0?this.message=this.modified.length+"箇所を修正しました！":this.message="問題のある箇所は見当たりませんでした！"}}},y=e=>(k("data-v-d105f9e1"),e=e(),A(),e),I=y(()=>r("h2",null,"ゲラから抽出した索引データの整形",-1)),V=y(()=>r("ul",null,[r("li",null,[r("strong",null,"ゲラからテキストを抽出すると長い行が折り返されて改行になっていることがあります。"),r("ul",null,[r("li",null,"そうした箇所は先に手動で整形してください。")])]),r("li",null,"見よ項目の矢印の前のアキを1倍モノに統一します。"),r("li",null,[g("連続するノンブルを示すダーシの種類を"),r("code",null,"–"),g("（enダーシ）に統一します。")]),r("li",null,[g("子項目のダーシの種類を"),r("code",null,"――"),g("（2倍ダーシ）に統一します。")])],-1)),H={key:0},N={class:"original"},W={class:"formatted"};function j(e,t,n,s,i,o){const u=d("PasteBox"),a=d("ResultBox");return m(),h(f,null,[I,l(u,{onUpdateContent:t[0]||(t[0]=c=>e.content=c.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),V,l(a,{result:o.resultStr},null,8,["result"]),r("div",null,[r("h4",null,p(e.message),1),o.modified.length?(m(),h("ol",H,[(m(!0),h(f,null,L(o.modified,(c,S)=>(m(),h("li",{key:S},[r("ul",null,[r("li",N,p(c.original),1),r("li",W,p(c.formatted),1)])]))),128))])):C("",!0)])],64)}const D=_(T,[["render",j],["__scopeId","data-v-d105f9e1"]]),q=""+new URL("resolveChild-958e8e93.png",import.meta.url).href,z=e=>{const t=[],n=[];t.push(e[0]),n.push(new $(e[0]).basename);for(let s=1;s<e.length;s++){const i=new $(e[s]),o=i.basename;if(o.startsWith("――")){const u=n.at(-1)+o.substring(2);t.push(u+"　　"+i.address)}else if(o.endsWith("――")){const u=o.substring(0,o.length-2)+n.at(-1);t.push(u+"　　"+i.address)}else t.push(i.rawStr),n.push(o)}return t},G={name:"ResolveChild",data:function(){return{content:"",fmtArr:[]}},components:{PasteBox:x,ResultBox:v},computed:{contentLines:function(){return this.content.split(/\n/).map(e=>String(e))},pureLines:function(){return this.contentLines.filter(e=>e.trim()).map(e=>e.trim())},resultStr:function(){return this.fmtArr.join(`
`)}},methods:{reset:function(){this.fmtArr=[]},executeFormat:function(){this.reset(),z(this.pureLines).forEach(e=>{this.fmtArr.push(e)})}}},J=r("h2",null,"子項目の復元",-1),K=r("div",null,[r("img",{src:q,alt:""})],-1);function M(e,t,n,s,i,o){const u=d("PasteBox"),a=d("ResultBox");return m(),h(f,null,[J,l(u,{onUpdateContent:t[0]||(t[0]=c=>e.content=c.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),l(a,{result:o.resultStr},null,8,["result"]),K],64)}const Q=_(G,[["render",M]]),X={name:"UngroupedTable",props:{lines:Array,resultStr:String},components:{CopyButton:w}},Y={key:0,class:"limit-height"},Z=r("thead",null,[r("tr",null,[r("th",null,"項目"),r("th",null,"ノンブル")])],-1);function tt(e,t,n,s,i,o){const u=d("CopyButton");return n.lines.length?(m(),h("div",Y,[r("table",null,[Z,r("tbody",null,[(m(!0),h(f,null,L(n.lines,(a,c)=>(m(),h("tr",{key:c},[r("td",null,p(a.name),1),r("td",null,p(a.nombre),1)]))),128))])]),l(u,{copyStr:n.resultStr},null,8,["copyStr"])])):C("",!0)}const et=_(X,[["render",tt]]),nt=""+new URL("ungroup-57a732db.png",import.meta.url).href,rt=e=>{const t=[];return e.filter(n=>n.trim()).map(n=>n.replace("	","　　")).forEach(n=>{const s=new $(n);s.isReference?t.push({name:s.name,nombre:""}):new F(s.address).nombres.forEach(i=>{t.push({name:s.name,nombre:i.display.text})})}),t},st={name:"Ungroup",data:function(){return{content:"",ungroupedLines:[]}},components:{CopyButton:w,PasteBox:x,UngroupedTable:et},computed:{contentLines:function(){return this.content.split(/\n/).map(e=>String(e))},resultStr:function(){return this.ungroupedLines.map(e=>`${e.name}	${e.nombre}`.trimEnd()).join(`
`)}},methods:{reset:function(){this.ungroupedLines=[]},executeFormat:function(){this.reset(),rt(this.contentLines).forEach((e,t)=>{this.ungroupedLines.push(e)})}}},ot=r("h2",null,"名開き",-1),it=r("div",null,[r("img",{src:nt,alt:""})],-1);function ut(e,t,n,s,i,o){const u=d("PasteBox"),a=d("UngroupedTable");return m(),h(f,null,[ot,l(u,{onUpdateContent:t[0]||(t[0]=c=>e.content=c.target.value),onButtonClicked:o.executeFormat},null,8,["onButtonClicked"]),l(a,{lines:e.ungroupedLines,resultStr:o.resultStr},null,8,["lines","resultStr"]),it],64)}const lt=_(st,[["render",ut]]),at={name:"ReuseView",components:{SectionEnd:E,FormatOld:D,ResolveChild:Q,Ungroup:lt}},ct={class:"reuse"},dt=r("h1",null,"旧版索引の再利用",-1);function mt(e,t,n,s,i,o){const u=d("FormatOld"),a=d("SectionEnd"),c=d("ResolveChild"),S=d("Ungroup");return m(),h("div",ct,[dt,l(u),l(a),l(c),l(a),l(S),l(a)])}const St=_(at,[["render",mt]]);export{St as default};
